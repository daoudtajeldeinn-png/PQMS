<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PQMS V009 - Enhanced Pharmaceutical Quality Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== MAIN STYLES ===== */
        :root {
            --navy: #002b5b; --blue: #159895; --gold: #fbc252; --bg: #f0f2f5;
            --white: #ffffff; --border: #d1d5db; --ok: #27ae60; --bad: #e74c3c;
            --warn: #f59e0b; --info: #3498db; --purple: #8e44ad;
            --arabic-font: 'Segoe UI', 'Tahoma', 'Arial', sans-serif;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            direction: ltr;
        }
        
        body.rtl {
            direction: rtl;
            font-family: var(--arabic-font);
            text-align: right;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 15px;
        }
        
        /* Language Toggle */
        .language-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 1000;
        }
        
        .lang-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .lang-btn.active {
            background: white;
            color: var(--navy);
        }
        
        /* Header */
        .system-header {
            background: linear-gradient(135deg, var(--navy) 0%, #004080 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            position: relative;
        }
        
        .system-title {
            font-size: 24px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .developer-info {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .compliance-badges {
            display: flex;
            gap: 5px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        
        .badge {
            background: #e8f5e9;
            color: #0f5132;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 10px;
            display: inline-block;
        }
        
        .badge.gmp { background: #e8f5e9; color: #0f5132; }
        .badge.gdp { background: #e3f2fd; color: #1565c0; }
        .badge.bp { background: #f3e5f5; color: #7b1fa2; }
        .badge.usp { background: #fff3e0; color: #f57c00; }
        .badge.eu { background: #e8f5e9; color: #388e3c; }
        
        /* Navigation */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .nav-tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 140px;
            justify-content: center;
            white-space: nowrap;
        }
        
        .nav-tab:hover {
            background: #f8f9fa;
            color: var(--navy);
        }
        
        .nav-tab.active {
            color: var(--navy);
            border-bottom: 3px solid var(--navy);
            background: #f8f9fa;
        }
        
        /* Content Areas */
        .content-area {
            display: none;
        }
        
        .content-area.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border-left: 4px solid var(--border);
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        /* Calculator Grids */
        .calculation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .calc-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border-top: 4px solid var(--border);
        }
        
        .calc-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .calc-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 14px;
            margin: 5px 0;
        }
        
        /* Data Tables */
        .data-table-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            overflow-x: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        .data-table th {
            background: #f8f9fa;
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            color: var(--navy);
            border-bottom: 2px solid var(--border);
        }
        
        .data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #eee;
        }
        
        /* Buttons */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }
        
        .btn-primary {
            background: var(--navy);
            color: white;
        }
        
        .btn-primary:hover {
            background: #001f3f;
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: var(--ok);
            color: white;
        }
        
        .btn-success:hover {
            background: #219653;
            transform: translateY(-1px);
        }
        
        .btn-danger {
            background: var(--bad);
            color: white;
        }
        
        .btn-warning {
            background: var(--warn);
            color: white;
        }
        
        .btn-info {
            background: var(--info);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--gray-700);
        }
        
        .btn-outline:hover {
            background: #f8f9fa;
        }
        
        /* Stepper */
        .entry-stepper {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            position: relative;
        }
        
        .step {
            position: relative;
            z-index: 2;
            text-align: center;
            flex: 1;
        }
        
        .step-number {
            width: 25px;
            height: 25px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #666;
            margin-bottom: 5px;
            font-size: 12px;
        }
        
        .step.active .step-number {
            background: var(--navy);
            color: white;
            border-color: var(--navy);
        }
        
        .step.completed .step-number {
            background: var(--ok);
            color: white;
            border-color: var(--ok);
        }
        
        .step-label {
            font-size: 11px;
            color: #666;
        }
        
        .step.active .step-label {
            color: var(--navy);
            font-weight: 600;
        }
        
        /* COA Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .coa-print, .coa-print * {
                visibility: visible;
            }
            .coa-print {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
        }
        
        .toast {
            background: white;
            border-radius: 6px;
            padding: 15px 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 300px;
            max-width: 400px;
            animation: slideIn 0.3s;
            border-left: 4px solid transparent;
            margin-bottom: 10px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .toast-success { border-left-color: var(--ok); }
        .toast-danger { border-left-color: var(--bad); }
        .toast-warning { border-left-color: var(--warn); }
        .toast-info { border-left-color: var(--info); }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .nav-tab { min-width: 100%; justify-content: flex-start; }
            .dashboard-grid, .calculation-grid { grid-template-columns: 1fr; }
            .language-toggle { position: static; text-align: right; margin-bottom: 10px; }
            .system-title { font-size: 20px; }
        }
        
        /* Loading Spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--navy);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- System Header -->
        <div class="system-header">
            <div>
                <h1 class="system-title">
                    <i class="fas fa-shield-alt"></i> <span data-translate="system_title">PQMS V009 - Enhanced</span>
                </h1>
                <div style="font-size: 14px;" data-translate="system_subtitle">Pharmaceutical Quality Management System</div>
                
                <div class="compliance-badges">
                    <span class="badge gmp">GMP</span>
                    <span class="badge gdp">GDP</span>
                    <span class="badge bp">BP 2025</span>
                    <span class="badge usp">USP 43</span>
                    <span class="badge eu">Ph.Eur.</span>
                    <span class="badge">ICH Q7</span>
                    <span class="badge">WHO</span>
                    <span class="badge">FDA</span>
                </div>
                
                <div class="developer-info">
                    <span data-translate="developed_by">Developed by:</span> Dr. Daoud Tajeldeinn Ahmed
                </div>
            </div>
            
            <div style="text-align: right;">
                <div class="language-toggle">
                    <button class="lang-btn active" onclick="switchLanguage('en')">English</button>
                    <button class="lang-btn" onclick="switchLanguage('ar')">العربية</button>
                </div>
                <div style="font-size: 14px;">
                    <span data-translate="status">Status:</span> 
                    <span style="color: #27ae60;">● <span data-translate="online">Online</span></span>
                </div>
                <div style="font-size: 12px;">
                    <span data-translate="user">User:</span> <strong data-translate="quality_manager">Quality Manager</strong>
                </div>
            </div>
        </div>
        
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="dashboard" onclick="showTab('dashboard')">
                <i class="fas fa-tachometer-alt"></i> <span data-translate="dashboard">Dashboard</span>
            </div>
            <div class="nav-tab" data-tab="ipqc-calculations" onclick="showTab('ipqc-calculations')">
                <i class="fas fa-calculator"></i> <span data-translate="ipqc_calculations">IPQC Calculations</span>
            </div>
            <div class="nav-tab" data-tab="granulation" onclick="showTab('granulation')">
                <i class="fas fa-powder"></i> <span data-translate="granulation">Granulation</span>
            </div>
            <div class="nav-tab" data-tab="compression" onclick="showTab('compression')">
                <i class="fas fa-compress-alt"></i> <span data-translate="compression">Compression</span>
            </div>
            <div class="nav-tab" data-tab="sachet-filling" onclick="showTab('sachet-filling')">
                <i class="fas fa-pouch"></i> <span data-translate="sachet_filling">Sachet Filling</span>
            </div>
            <div class="nav-tab" data-tab="analysis-entry" onclick="showTab('analysis-entry')">
                <i class="fas fa-file-signature"></i> <span data-translate="analysis_entry">Analysis Entry</span>
            </div>
            <div class="nav-tab" data-tab="coa-generator" onclick="showTab('coa-generator')">
                <i class="fas fa-file-certificate"></i> <span data-translate="coa_generator">COA Generator</span>
            </div>
            <div class="nav-tab" data-tab="reports" onclick="showTab('reports')">
                <i class="fas fa-file-pdf"></i> <span data-translate="reports">Reports</span>
            </div>
            <div class="nav-tab" data-tab="microbiology" onclick="showTab('microbiology')">
                <i class="fas fa-microscope"></i> <span data-translate="microbiology">Microbiology</span>
            </div>
            <div class="nav-tab" data-tab="stability" onclick="showTab('stability')">
                <i class="fas fa-chart-line"></i> <span data-translate="stability">Stability</span>
            </div>
        </div>
        
        <!-- Dashboard -->
        <div id="dashboard" class="content-area active">
            <h2 style="color: var(--navy); margin-bottom: 15px;">
                <i class="fas fa-tachometer-alt"></i> <span data-translate="quality_dashboard">Quality Dashboard</span>
            </h2>
            
            <div class="dashboard-grid">
                <div class="stat-card" style="border-left-color: var(--ok);" onclick="showTab('reports')">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 13px; color: #666;" data-translate="quality_compliance">Quality Compliance</div>
                            <div style="font-size: 32px; font-weight: 800; color: var(--ok);">98.7%</div>
                        </div>
                        <i class="fas fa-check-circle" style="font-size: 36px; color: rgba(39, 174, 96, 0.2);"></i>
                    </div>
                </div>
                
                <div class="stat-card" style="border-left-color: var(--warn);" onclick="showTab('ipqc-calculations')">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 13px; color: #666;" data-translate="active_ipqc">Active IPQC Tests</div>
                            <div style="font-size: 32px; font-weight: 800; color: var(--warn);" id="activeIPQCCount">14</div>
                        </div>
                        <i class="fas fa-vial" style="font-size: 36px; color: rgba(245, 158, 11, 0.2);"></i>
                    </div>
                </div>
                
                <div class="stat-card" style="border-left-color: var(--purple);" onclick="showTab('analysis-entry')">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 13px; color: #666;" data-translate="completed_tests">Completed Tests</div>
                            <div style="font-size: 32px; font-weight: 800; color: var(--purple);" id="completedTestsCount">203</div>
                        </div>
                        <i class="fas fa-clipboard-check" style="font-size: 36px; color: rgba(142, 68, 173, 0.2);"></i>
                    </div>
                </div>
                
                <div class="stat-card" style="border-left-color: var(--info);" onclick="showTab('microbiology')">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 13px; color: #666;" data-translate="microbiology_tests">Microbiology Tests</div>
                            <div style="font-size: 32px; font-weight: 800; color: var(--info);" id="microTestsCount">67</div>
                        </div>
                        <i class="fas fa-microscope" style="font-size: 36px; color: rgba(52, 152, 219, 0.2);"></i>
                    </div>
                </div>
            </div>
            
            <!-- Recent Analyses -->
            <div class="data-table-container">
                <h3 style="color: var(--navy); margin-bottom: 15px;" data-translate="recent_analyses">Recent Completed Analyses</h3>
                <table class="data-table" id="recentAnalysesTable">
                    <thead>
                        <tr>
                            <th data-translate="material">Material</th>
                            <th data-translate="batch_no">Batch No.</th>
                            <th data-translate="test_type">Test Type</th>
                            <th data-translate="completed_date">Completed Date</th>
                            <th data-translate="status">Status</th>
                            <th data-translate="actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Metronidazole BP</td>
                            <td>BN-2025-001</td>
                            <td>API Full Analysis</td>
                            <td>2025-01-20</td>
                            <td><span style="color: var(--ok); font-weight: 600;">PASS</span></td>
                            <td><button class="btn" style="padding: 4px 8px; font-size: 12px;" onclick="generateCOA('BN-2025-001')"><i class="fas fa-print"></i></button></td>
                        </tr>
                        <tr>
                            <td>Aspirin Tablets</td>
                            <td>BN-2025-002</td>
                            <td>Finished Product</td>
                            <td>2025-01-19</td>
                            <td><span style="color: var(--ok); font-weight: 600;">PASS</span></td>
                            <td><button class="btn" style="padding: 4px 8px; font-size: 12px;" onclick="generateCOA('BN-2025-002')"><i class="fas fa-print"></i></button></td>
                        </tr>
                        <tr>
                            <td>Purified Water</td>
                            <td>WTR-2025-001</td>
                            <td>Water System</td>
                            <td>2025-01-18</td>
                            <td><span style="color: var(--ok); font-weight: 600;">PASS</span></td>
                            <td><button class="btn" style="padding: 4px 8px; font-size: 12px;" onclick="generateCOA('WTR-2025-001')"><i class="fas fa-print"></i></button></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Quick Actions -->
            <div class="dashboard-grid" style="margin-top: 20px;">
                <div class="stat-card" onclick="showTab('coa-generator')" style="text-align: center;">
                    <i class="fas fa-file-certificate" style="font-size: 36px; color: var(--info); margin-bottom: 10px;"></i>
                    <h4 data-translate="certificate_analysis">Certificate of Analysis</h4>
                    <p style="color: #666; margin: 10px 0; font-size: 14px;" data-translate="coa_description">Generate COA for materials</p>
                </div>
                
                <div class="stat-card" onclick="showTab('ipqc-calculations')" style="text-align: center;">
                    <i class="fas fa-calculator" style="font-size: 36px; color: var(--warn); margin-bottom: 10px;"></i>
                    <h4 data-translate="ipqc_calculations">IPQC Calculations</h4>
                    <p style="color: #666; margin: 10px 0; font-size: 14px;">Perform in-process quality checks</p>
                </div>
                
                <div class="stat-card" onclick="showTab('analysis-entry')" style="text-align: center;">
                    <i class="fas fa-microscope" style="font-size: 36px; color: var(--purple); margin-bottom: 10px;"></i>
                    <h4 data-translate="microbiology_tests">Microbiology Tests</h4>
                    <p style="color: #666; margin: 10px 0; font-size: 14px;">All materials require microbiology testing</p>
                </div>
            </div>
        </div>
        
        <!-- IPQC Calculations -->
        <div id="ipqc-calculations" class="content-area">
            <h2 style="color: var(--navy); margin-bottom: 15px;">
                <i class="fas fa-calculator"></i> <span data-translate="ipqc_calculations_title">IPQC Calculations (BP/USP Compliance)</span>
            </h2>
            
            <div class="calculation-grid">
                <!-- Tablet Weight Variation -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-weight"></i> <span data-translate="tablet_weight_var">Tablet Weight Variation</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        USP <905> <span data-translate="uniformity_dosage">Uniformity of Dosage Units</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="avg_weight">Average Weight (mg)</label>
                        <input type="number" class="calc-input" id="avgTabletWeight" value="500" step="0.1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="individual_weights">Individual Weights (mg, comma separated)</label>
                        <input type="text" class="calc-input" id="individualWeights" value="498,502,499,501,497,503,500,499,501,498">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateWeightVariation()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="weightVariationResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="result_appear">Result will appear here</span>
                    </div>
                </div>
                
                <!-- Content Uniformity -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-vial"></i> <span data-translate="content_uniformity">Content Uniformity</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        USP <905> <span data-translate="content_uniformity_test">Content Uniformity Test</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="assay_results">Assay Results (%, comma separated)</label>
                        <input type="text" class="calc-input" id="assayResults" value="100.2,99.8,101.0,98.5,100.5,99.2,100.8,101.2,99.5,100.0">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateContentUniformity()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="contentUniformityResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="acceptance_value">Acceptance Value (AV) will appear here</span>
                    </div>
                </div>
                
                <!-- Disintegration Test -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-hourglass-half"></i> <span data-translate="disintegration_test">Disintegration Test</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        USP <701> <span data-translate="disintegration">Disintegration</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="disintegration_times">Disintegration Times (minutes, comma separated)</label>
                        <input type="text" class="calc-input" id="disintegrationTimes" value="8.5,9.0,8.0,8.5,9.5,8.0">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="specification_limit">Specification Limit (minutes)</label>
                        <input type="number" class="calc-input" id="disintegrationLimit" value="15" step="0.1">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateDisintegration()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="disintegrationResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="disintegration_result">Disintegration test result will appear here</span>
                    </div>
                </div>
                
                <!-- Friability Test -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-cube"></i> <span data-translate="friability_test">Friability Test</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        USP <1216> <span data-translate="tablet_friability">Tablet Friability</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="initial_weight">Initial Weight (g)</label>
                        <input type="number" class="calc-input" id="initialFriabilityWeight" value="6.512" step="0.001">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="final_weight">Final Weight (g)</label>
                        <input type="number" class="calc-input" id="finalFriabilityWeight" value="6.480" step="0.001">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateFriability()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="friabilityResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="friability_percentage">Friability percentage will appear here</span>
                    </div>
                </div>
                
                <!-- Hardness Test -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-hard-hat"></i> <span data-translate="hardness_test">Hardness Test</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        USP <1217> <span data-translate="tablet_breaking">Tablet Breaking Force</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="hardness_values">Hardness Values (kp, comma separated)</label>
                        <input type="text" class="calc-input" id="hardnessValues" value="6.5,7.0,6.8,7.2,6.9,7.1,6.7,7.0,6.8,7.3">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="hardness_spec">Hardness Specification (kp)</label>
                        <input type="text" class="calc-input" id="hardnessSpec" value="4-10">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateHardness()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="hardnessResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="hardness_result">Hardness results will appear here</span>
                    </div>
                </div>
                
                <!-- Thickness & Diameter -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-ruler-combined"></i> <span data-translate="thickness_diameter">Thickness & Diameter</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        <span data-translate="dimensional_tests">Dimensional Tests</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="thickness_values">Thickness Values (mm, comma separated)</label>
                        <input type="text" class="calc-input" id="thicknessValues" value="3.2,3.3,3.1,3.4,3.2,3.3,3.1,3.2,3.3,3.2">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="diameter_values">Diameter Values (mm, comma separated)</label>
                        <input type="text" class="calc-input" id="diameterValues" value="8.0,8.1,7.9,8.0,8.1,8.0,7.9,8.0,8.1,8.0">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateDimensions()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="dimensionsResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="dimensions_result">Thickness & diameter results will appear here</span>
                    </div>
                </div>
            </div>
            
            <!-- GMP/GDP Parameters -->
            <div class="data-table-container" style="margin-top: 20px;">
                <h3 style="color: var(--navy); margin-bottom: 15px;" data-translate="gmp_parameters">GMP/GDP Parameter Limits</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th data-translate="parameter">Parameter</th>
                            <th data-translate="bp_limit">BP Limit</th>
                            <th data-translate="usp_limit">USP Limit</th>
                            <th data-translate="eu_limit">Ph.Eur. Limit</th>
                            <th data-translate="acceptance_criteria">Acceptance Criteria</th>
                            <th data-translate="gdp_compliance">GDP Compliance</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-translate="weight_var_tablets">Weight Variation (Tablets ≥ 250mg)</td>
                            <td>±5%</td>
                            <td>±5%</td>
                            <td>±5%</td>
                            <td data-translate="weight_criteria">Not more than 2 tablets outside ±10%, none outside ±20%</td>
                            <td><span class="badge">ALCOA+</span></td>
                        </tr>
                        <tr>
                            <td data-translate="content_uniformity_av">Content Uniformity (AV)</td>
                            <td>≤15.0</td>
                            <td>≤15.0</td>
                            <td>≤15.0</td>
                            <td data-translate="content_criteria">Stage 1: AV ≤ 15.0, Stage 2: AV ≤ 25.0</td>
                            <td><span class="badge">Attributable</span></td>
                        </tr>
                        <tr>
                            <td data-translate="disintegration_uncoated">Disintegration (Uncoated Tablets)</td>
                            <td>15 minutes</td>
                            <td>15 minutes</td>
                            <td>15 minutes</td>
                            <td data-translate="disintegration_criteria">All tablets disintegrate completely</td>
                            <td><span class="badge">Contemporaneous</span></td>
                        </tr>
                        <tr>
                            <td data-translate="friability">Friability</td>
                            <td>≤1.0%</td>
                            <td>≤1.0%</td>
                            <td>≤1.0%</td>
                            <td data-translate="friability_criteria">If >1.0%, repeat test on 3 additional samples</td>
                            <td><span class="badge">Original</span></td>
                        </tr>
                        <tr>
                            <td data-translate="hardness">Hardness</td>
                            <td>4-10 kg</td>
                            <td>4-10 kg</td>
                            <td>4-10 kg</td>
                            <td data-translate="hardness_criteria">Product specific, maintain consistent hardness</td>
                            <td><span class="badge">Accurate</span></td>
                        </tr>
                        <tr>
                            <td data-translate="thickness">Thickness</td>
                            <td>±5%</td>
                            <td>±5%</td>
                            <td>±5%</td>
                            <td data-translate="thickness_criteria">Individual variation ±5%, average ±3%</td>
                            <td><span class="badge">Legible</span></td>
                        </tr>
                        <tr>
                            <td data-translate="diameter">Diameter</td>
                            <td>±0.5 mm</td>
                            <td>±0.5 mm</td>
                            <td>±0.5 mm</td>
                            <td data-translate="diameter_criteria">For tablets > 10mm: ±0.5mm, < 10mm: ±0.3mm</td>
                            <td><span class="badge">Enduring</span></td>
                        </tr>
                        <tr>
                            <td data-translate="dissolution">Dissolution</td>
                            <td>Q=80% in 45 min</td>
                            <td>Q=75% in 45 min</td>
                            <td>Q=75% in 45 min</td>
                            <td data-translate="dissolution_criteria">Stage 1: All units ≥ Q+5%, Stage 2: Average ≥ Q</td>
                            <td><span class="badge">Complete</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Granulation Module -->
        <div id="granulation" class="content-area">
            <h2 style="color: var(--navy); margin-bottom: 15px;">
                <i class="fas fa-powder"></i> <span data-translate="granulation_calculations">Granulation Calculations</span>
            </h2>
            
            <div class="calculation-grid">
                <!-- Powder Flowability -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-wind"></i> <span data-translate="powder_flowability">Powder Flowability</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        USP <1174> <span data-translate="powder_flow">Powder Flow</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="heap_height">Heap Height (cm)</label>
                        <input type="number" class="calc-input" id="heapHeight" value="5.0" step="0.1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="heap_diameter">Heap Diameter (cm)</label>
                        <input type="number" class="calc-input" id="heapDiameter" value="10.0" step="0.1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="flow_time">Flow Time (seconds)</label>
                        <input type="number" class="calc-input" id="flowTime" value="4.5" step="0.1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="powder_weight">Powder Weight (g)</label>
                        <input type="number" class="calc-input" id="powderWeight" value="100.0" step="0.1">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateFlowability()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="flowabilityResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="flowability_result">Flowability results will appear here</span>
                    </div>
                </div>
                
                <!-- Tap Density -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-weight-hanging"></i> <span data-translate="tap_density">Tap Density</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        USP <616> <span data-translate="bulk_density">Bulk Density and Tapped Density</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="initial_volume">Initial Volume (mL)</label>
                        <input type="number" class="calc-input" id="initialVolume" value="100.0" step="0.1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="tapped_volume">Tapped Volume (mL)</label>
                        <input type="number" class="calc-input" id="tappedVolume" value="85.0" step="0.1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="sample_weight_tap">Sample Weight (g)</label>
                        <input type="number" class="calc-input" id="sampleWeightTap" value="50.0" step="0.1">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateTapDensity()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="tapDensityResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="tap_density_result">Tap density results will appear here</span>
                    </div>
                </div>
                
                <!-- Particle Size Distribution -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-chart-pie"></i> <span data-translate="particle_size_dist">Particle Size Distribution</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        USP <429> <span data-translate="light_diffraction">Light Diffraction Measurement</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="d10">D10 (µm)</label>
                        <input type="number" class="calc-input" id="d10" value="15.0" step="0.1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="d50">D50 (µm)</label>
                        <input type="number" class="calc-input" id="d50" value="45.0" step="0.1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="d90">D90 (µm)</label>
                        <input type="number" class="calc-input" id="d90" value="90.0" step="0.1">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculatePSD()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="psdResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="psd_result">Particle size results will appear here</span>
                    </div>
                </div>
                
                <!-- Distribution Factor -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-percentage"></i> <span data-translate="distribution_factor">Distribution Factor</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        <span data-translate="uniformity_index">Uniformity Index Calculation</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="particle_sizes">Particle Sizes (µm, comma separated)</label>
                        <input type="text" class="calc-input" id="particleSizes" value="10,15,20,25,30,35,40,45,50,55,60,65,70,75,80">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="target_size">Target Size (µm)</label>
                        <input type="number" class="calc-input" id="targetSize" value="50.0" step="0.1">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateDistributionFactor()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="distributionResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="distribution_result">Distribution factor will appear here</span>
                    </div>
                </div>
            </div>
            
            <!-- Granulation GMP Parameters -->
            <div class="data-table-container" style="margin-top: 20px;">
                <h3 style="color: var(--navy); margin-bottom: 15px;" data-translate="granulation_gmp">Granulation GMP Parameters</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th data-translate="parameter">Parameter</th>
                            <th data-translate="acceptance_limit">Acceptance Limit</th>
                            <th data-translate="action_limit">Action Limit</th>
                            <th data-translate="testing_frequency">Testing Frequency</th>
                            <th data-translate="method">Method</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-translate="powder_flow_rate">Powder Flow Rate</td>
                            <td>4-6 g/sec</td>
                            <td>3-7 g/sec</td>
                            <td>Every batch</td>
                            <td>USP <1174></td>
                        </tr>
                        <tr>
                            <td data-translate="angle_repose">Angle of Repose</td>
                            <td>≤ 30°</td>
                            <td>≤ 35°</td>
                            <td>Every batch</td>
                            <td>USP <1174></td>
                        </tr>
                        <tr>
                            <td data-translate="bulk_density_table">Bulk Density</td>
                            <td>0.4-0.6 g/mL</td>
                            <td>0.3-0.7 g/mL</td>
                            <td>Every batch</td>
                            <td>USP <616></td>
                        </tr>
                        <tr>
                            <td data-translate="tapped_density">Tapped Density</td>
                            <td>0.5-0.7 g/mL</td>
                            <td>0.4-0.8 g/mL</td>
                            <td>Every batch</td>
                            <td>USP <616></td>
                        </tr>
                        <tr>
                            <td data-translate="compressibility_index">Compressibility Index</td>
                            <td>≤ 20%</td>
                            <td>≤ 25%</td>
                            <td>Every batch</td>
                            <td>USP <1174></td>
                        </tr>
                        <tr>
                            <td data-translate="hausner_ratio">Hausner Ratio</td>
                            <td>≤ 1.25</td>
                            <td>≤ 1.35</td>
                            <td>Every batch</td>
                            <td>USP <1174></td>
                        </tr>
                        <tr>
                            <td data-translate="particle_size_d10">Particle Size D10</td>
                            <td>10-20 µm</td>
                            <td>5-25 µm</td>
                            <td>Every batch</td>
                            <td>USP <429></td>
                        </tr>
                        <tr>
                            <td data-translate="particle_size_d50">Particle Size D50</td>
                            <td>40-60 µm</td>
                            <td>30-70 µm</td>
                            <td>Every batch</td>
                            <td>USP <429></td>
                        </tr>
                        <tr>
                            <td data-translate="particle_size_d90">Particle Size D90</td>
                            <td>80-120 µm</td>
                            <td>70-150 µm</td>
                            <td>Every batch</td>
                            <td>USP <429></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Compression Module -->
        <div id="compression" class="content-area">
            <h2 style="color: var(--navy); margin-bottom: 15px;">
                <i class="fas fa-compress-alt"></i> <span data-translate="compression_parameters">Compression Parameters</span>
            </h2>
            
            <div class="calculation-grid">
                <!-- Compression Force -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-compress-arrows-alt"></i> <span data-translate="compression_force">Compression Force</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        <span data-translate="machine_settings">Machine Settings Analysis</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="upper_punch">Upper Punch Force (kN)</label>
                        <input type="number" class="calc-input" id="upperPunch" value="25.5" step="0.1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="lower_punch">Lower Punch Force (kN)</label>
                        <input type="number" class="calc-input" id="lowerPunch" value="15.5" step="0.1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="ejection_force">Ejection Force (kN)</label>
                        <input type="number" class="calc-input" id="ejectionForce" value="1.2" step="0.1">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateCompressionForce()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="compressionResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="compression_result">Compression force results will appear here</span>
                    </div>
                </div>
                
                <!-- Compression Ratio -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-exchange-alt"></i> <span data-translate="compression_ratio">Compression Ratio</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        <span data-translate="powder_characteristics">Powder Characteristics Analysis</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="bulk_density_comp">Bulk Density (g/mL)</label>
                        <input type="number" class="calc-input" id="bulkDensityComp" value="0.45" step="0.01">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="tablet_density">Tablet Density (g/mL)</label>
                        <input type="number" class="calc-input" id="tabletDensity" value="1.25" step="0.01">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="die_fill_depth">Die Fill Depth (mm)</label>
                        <input type="number" class="calc-input" id="dieFillDepth" value="12.5" step="0.1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="tablet_thickness_comp">Tablet Thickness (mm)</label>
                        <input type="number" class="calc-input" id="tabletThicknessComp" value="3.2" step="0.1">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateCompressionRatio()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="compressionRatioResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="compression_ratio_result">Compression ratio results will appear here</span>
                    </div>
                </div>
                
                <!-- Tablet Porosity -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-layer-group"></i> <span data-translate="tablet_porosity">Tablet Porosity</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        <span data-translate="porosity_calculation">Porosity Calculation</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="true_density">True Density (g/mL)</label>
                        <input type="number" class="calc-input" id="trueDensity" value="1.45" step="0.01">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="apparent_density">Apparent Density (g/mL)</label>
                        <input type="number" class="calc-input" id="apparentDensity" value="1.25" step="0.01">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="tablet_weight_porosity">Tablet Weight (mg)</label>
                        <input type="number" class="calc-input" id="tabletWeightPorosity" value="500" step="1">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculatePorosity()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="porosityResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="porosity_result">Porosity results will appear here</span>
                    </div>
                </div>
            </div>
            
            <!-- Compression GMP Parameters -->
            <div class="data-table-container" style="margin-top: 20px;">
                <h3 style="color: var(--navy); margin-bottom: 15px;" data-translate="compression_gmp">Compression GMP Parameters</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th data-translate="parameter">Parameter</th>
                            <th data-translate="acceptance_limit">Acceptance Limit</th>
                            <th data-translate="action_limit">Action Limit</th>
                            <th data-translate="testing_frequency">Testing Frequency</th>
                            <th data-translate="method">Method</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-translate="compression_force_param">Compression Force</td>
                            <td>20-30 kN</td>
                            <td>15-35 kN</td>
                            <td>Every 30 minutes</td>
                            <td>In-process control</td>
                        </tr>
                        <tr>
                            <td data-translate="ejection_force_param">Ejection Force</td>
                            <td>≤ 2 kN</td>
                            <td>≤ 3 kN</td>
                            <td>Every hour</td>
                            <td>In-process control</td>
                        </tr>
                        <tr>
                            <td data-translate="pre_compression">Pre-compression Force</td>
                            <td>5-10 kN</td>
                            <td>3-12 kN</td>
                            <td>Every 2 hours</td>
                            <td>In-process control</td>
                        </tr>
                        <tr>
                            <td data-translate="compression_speed">Compression Speed</td>
                            <td>20-40 rpm</td>
                            <td>15-50 rpm</td>
                            <td>Continuous</td>
                            <td>Machine setting</td>
                        </tr>
                        <tr>
                            <td data-translate="dwell_time">Dwell Time</td>
                            <td>20-50 ms</td>
                            <td>15-60 ms</td>
                            <td>Every 2 hours</td>
                            <td>Machine setting</td>
                        </tr>
                        <tr>
                            <td data-translate="tablet_weight_comp">Tablet Weight</td>
                            <td>±5% of target</td>
                            <td>±7% of target</td>
                            <td>Every 15 minutes</td>
                            <td>USP <905></td>
                        </tr>
                        <tr>
                            <td data-translate="tablet_hardness_comp">Tablet Hardness</td>
                            <td>4-10 kp</td>
                            <td>3-12 kp</td>
                            <td>Every 30 minutes</td>
                            <td>USP <1217></td>
                        </tr>
                        <tr>
                            <td data-translate="tablet_thickness_param">Tablet Thickness</td>
                            <td>±3% of target</td>
                            <td>±5% of target</td>
                            <td>Every 30 minutes</td>
                            <td>In-process control</td>
                        </tr>
                        <tr>
                            <td data-translate="tablet_diameter_param">Tablet Diameter</td>
                            <td>±0.2 mm</td>
                            <td>±0.3 mm</td>
                            <td>Every 30 minutes</td>
                            <td>In-process control</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Sachet Filling Module -->
        <div id="sachet-filling" class="content-area">
            <h2 style="color: var(--navy); margin-bottom: 15px;">
                <i class="fas fa-pouch"></i> <span data-translate="sachet_filling_calc">Sachet Filling Calculations</span>
            </h2>
            
            <div class="calculation-grid">
                <!-- Sachet Weight Variation -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-weight"></i> <span data-translate="sachet_weight_var">Sachet Weight Variation</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        USP <905> <span data-translate="powder_uniformity">Powder Uniformity</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="target_sachet_weight">Target Sachet Weight (g)</label>
                        <input type="number" class="calc-input" id="targetSachetWeight" value="5.0" step="0.01">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="sachet_weights">Sachet Weights (g, comma separated)</label>
                        <input type="text" class="calc-input" id="sachetWeights" value="5.1,4.9,5.0,5.2,4.8,5.1,5.0,4.9,5.1,5.0">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="sachet_limit">Acceptance Limit (%)</label>
                        <input type="number" class="calc-input" id="sachetLimit" value="10" step="0.1">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateSachetWeight()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="sachetWeightResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="sachet_result">Sachet weight results will appear here</span>
                    </div>
                </div>
                
                <!-- Seal Integrity -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-seal"></i> <span data-translate="seal_integrity">Seal Integrity</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        ASTM F88 <span data-translate="seal_strength">Seal Strength Testing</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="seal_strength_values">Seal Strength Values (N/15mm, comma separated)</label>
                        <input type="text" class="calc-input" id="sealStrengthValues" value="12.5,13.0,12.8,13.2,12.7,13.1,12.9,13.0,12.8,13.1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="minimum_seal">Minimum Seal Strength (N/15mm)</label>
                        <input type="number" class="calc-input" id="minSealStrength" value="10.0" step="0.1">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateSealIntegrity()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="sealResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="seal_result">Seal integrity results will appear here</span>
                    </div>
                </div>
                
                <!-- Fill Accuracy -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-tachometer-alt"></i> <span data-translate="fill_accuracy">Fill Accuracy</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        <span data-translate="filling_validation">Filling Machine Validation</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="fill_weights">Fill Weights (g, comma separated)</label>
                        <input type="text" class="calc-input" id="fillWeights" value="5.05,4.95,5.02,4.98,5.01,4.99,5.03,4.97,5.00,5.01">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="fill_spec">Fill Specification (±g)</label>
                        <input type="number" class="calc-input" id="fillSpec" value="0.1" step="0.01">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateFillAccuracy()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="fillResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="fill_result">Fill accuracy results will appear here</span>
                    </div>
                </div>
            </div>
            
            <!-- Sachet GMP Parameters -->
            <div class="data-table-container" style="margin-top: 20px;">
                <h3 style="color: var(--navy); margin-bottom: 15px;">Sachet Filling GMP Parameters</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Acceptance Limit</th>
                            <th>Action Limit</th>
                            <th>Testing Frequency</th>
                            <th>GDP Compliance</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Weight Variation</td>
                            <td>±10% of target weight</td>
                            <td>±15% of target weight</td>
                            <td>Every 30 minutes</td>
                            <td><span class="badge">Complete</span></td>
                        </tr>
                        <tr>
                            <td>Seal Strength</td>
                            <td>≥10 N/15mm</td>
                            <td>≥8 N/15mm</td>
                            <td>Every hour</td>
                            <td><span class="badge">Original</span></td>
                        </tr>
                        <tr>
                            <td>Fill Accuracy (Cp)</td>
                            <td>Cp ≥ 1.33</td>
                            <td>Cp ≥ 1.0</td>
                            <td>Daily</td>
                            <td><span class="badge">Accurate</span></td>
                        </tr>
                        <tr>
                            <td>Leak Test</td>
                            <td>No leaks</td>
                            <td>≤1% defective</td>
                            <td>Every batch</td>
                            <td><span class="badge">Enduring</span></td>
                        </tr>
                        <tr>
                            <td>Moisture Content</td>
                            <td>≤5%</td>
                            <td>≤7%</td>
                            <td>Every batch</td>
                            <td><span class="badge">Legible</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Microbiology Module -->
        <div id="microbiology" class="content-area">
            <h2 style="color: var(--navy); margin-bottom: 15px;">
                <i class="fas fa-microscope"></i> <span data-translate="microbiology_tests">Microbiology Tests & Requirements</span>
            </h2>
            
            <div class="data-table-container">
                <h3 style="color: var(--navy); margin-bottom: 15px;" data-translate="microbiology_requirements_table">Microbiology Requirements by Material Type</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th data-translate="material_type">Material Type</th>
                            <th data-translate="required_tests">Required Tests</th>
                            <th data-translate="acceptance_criteria">Acceptance Criteria</th>
                            <th data-translate="method">Method</th>
                            <th data-translate="frequency">Frequency</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-translate="api_micro">Active Pharmaceutical Ingredients (APIs)</td>
                            <td>TAMC, TYMC, E. coli, Salmonella, S. aureus</td>
                            <td>TAMC ≤ 1000 cfu/g, TYMC ≤ 100 cfu/g, Pathogens: Absent in 10g</td>
                            <td>USP <61>, <62></td>
                            <td>Every batch</td>
                        </tr>
                        <tr>
                            <td data-translate="excipients_micro">Excipients</td>
                            <td>TAMC, TYMC</td>
                            <td>TAMC ≤ 1000 cfu/g, TYMC ≤ 100 cfu/g</td>
                            <td>USP <61></td>
                            <td>Every batch</td>
                        </tr>
                        <tr>
                            <td data-translate="finished_products_micro">Finished Products (Oral)</td>
                            <td>TAMC, TYMC, E. coli, Salmonella</td>
                            <td>TAMC ≤ 1000 cfu/g, TYMC ≤ 100 cfu/g, Pathogens: Absent in 10g</td>
                            <td>USP <61>, <62></td>
                            <td>Every batch</td>
                        </tr>
                        <tr>
                            <td data-translate="sterile_products">Sterile Products</td>
                            <td>Sterility, Endotoxins, Bioburden</td>
                            <td>Sterile, Endotoxins < 0.25 EU/mL, Bioburden ≤ 10 cfu/100mL</td>
                            <td>USP <71>, <85>, <61></td>
                            <td>Every batch</td>
                        </tr>
                        <tr>
                            <td data-translate="water_systems">Water Systems</td>
                            <td>TAMC, Endotoxins (Purified Water)</td>
                            <td>TAMC ≤ 100 cfu/mL, Endotoxins < 0.25 EU/mL</td>
                            <td>USP <61>, <85></td>
                            <td>Weekly/Monthly</td>
                        </tr>
                        <tr>
                            <td data-translate="packaging_materials">Packaging Materials</td>
                            <td>Bioburden, Sterility (if required)</td>
                            <td>Bioburden ≤ 100 cfu/unit, Sterile if specified</td>
                            <td>USP <61></td>
                            <td>Every batch/lot</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="calculation-grid">
                <!-- Microbial Count Calculator -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-bacteria"></i> <span data-translate="microbial_count">Microbial Count Calculation</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        USP <61> <span data-translate="microbial_enumeration">Microbial Enumeration Tests</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="colony_count">Colony Count</label>
                        <input type="number" class="calc-input" id="colonyCount" value="120" step="1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="dilution_factor">Dilution Factor</label>
                        <input type="number" class="calc-input" id="dilutionFactor" value="100" step="1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="sample_volume">Sample Volume (mL/g)</label>
                        <input type="number" class="calc-input" id="sampleVolume" value="1.0" step="0.1">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateMicrobialCount()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="microbialCountResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="microbial_result">Microbial count results will appear here</span>
                    </div>
                </div>
                
                <!-- Endotoxin Calculator -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-vial"></i> <span data-translate="endotoxin_calculation">Endotoxin Calculation</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        USP <85> <span data-translate="bacterial_endotoxins">Bacterial Endotoxins Test</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="sample_endotoxin">Sample Endotoxin (EU/mL)</label>
                        <input type="number" class="calc-input" id="sampleEndotoxin" value="0.15" step="0.01">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="maximum_dose">Maximum Dose (mL/kg)</label>
                        <input type="number" class="calc-input" id="maximumDose" value="10" step="0.1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="endotoxin_limit">Endotoxin Limit (EU/kg)</label>
                        <input type="number" class="calc-input" id="endotoxinLimit" value="5.0" step="0.1">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateEndotoxin()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="endotoxinResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="endotoxin_result">Endotoxin calculation results will appear here</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Stability Module -->
        <div id="stability" class="content-area">
            <h2 style="color: var(--navy); margin-bottom: 15px;">
                <i class="fas fa-chart-line"></i> <span data-translate="stability_studies">Stability Studies</span>
            </h2>
            
            <div class="data-table-container">
                <h3 style="color: var(--navy); margin-bottom: 15px;" data-translate="stability_conditions">ICH Stability Testing Conditions</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th data-translate="study_type">Study Type</th>
                            <th data-translate="storage_condition">Storage Condition</th>
                            <th data-translate="minimum_duration">Minimum Duration</th>
                            <th data-translate="application">Application</th>
                            <th data-translate="ich_guideline">ICH Guideline</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-translate="long_term">Long Term</td>
                            <td>25°C ± 2°C / 60% RH ± 5% RH</td>
                            <td>12 months</td>
                            <td data-translate="climatic_zone">Climatic Zone II</td>
                            <td>ICH Q1A(R2)</td>
                        </tr>
                        <tr>
                            <td data-translate="intermediate">Intermediate</td>
                            <td>30°C ± 2°C / 65% RH ± 5% RH</td>
                            <td>6 months</td>
                            <td data-translate="climatic_zone_iii">Climatic Zone III/IV</td>
                            <td>ICH Q1A(R2)</td>
                        </tr>
                        <tr>
                            <td data-translate="accelerated">Accelerated</td>
                            <td>40°C ± 2°C / 75% RH ± 5% RH</td>
                            <td>6 months</td>
                            <td data-translate="supporting_data">Supporting data</td>
                            <td>ICH Q1A(R2)</td>
                        </tr>
                        <tr>
                            <td data-translate="refrigerated">Refrigerated</td>
                            <td>5°C ± 3°C</td>
                            <td>12 months</td>
                            <td data-translate="cold_products">Cold chain products</td>
                            <td>ICH Q1A(R2)</td>
                        </tr>
                        <tr>
                            <td data-translate="freezer">Freezer</td>
                            <td>-20°C ± 5°C</td>
                            <td>12 months</td>
                            <td data-translate="frozen_products">Frozen products</td>
                            <td>ICH Q1A(R2)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="calculation-grid">
                <!-- Shelf Life Calculator -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-clock"></i> <span data-translate="shelf_life_calculator">Shelf Life Calculator</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        ICH Q1E <span data-translate="evaluation_stability">Evaluation of Stability Data</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="assay_initial">Initial Assay (%)</label>
                        <input type="number" class="calc-input" id="assayInitial" value="100.5" step="0.1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="assay_12m">Assay at 12 months (%)</label>
                        <input type="number" class="calc-input" id="assay12m" value="99.2" step="0.1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="assay_spec">Assay Specification (%)</label>
                        <input type="text" class="calc-input" id="assaySpec" value="95.0-105.0">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="degradation_rate">Degradation Rate (%/month)</label>
                        <input type="number" class="calc-input" id="degradationRate" value="0.1" step="0.01">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateShelfLife()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="shelfLifeResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="shelf_life_result">Shelf life results will appear here</span>
                    </div>
                </div>
                
                <!-- Stability Testing Points -->
                <div class="calc-card">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-calendar-alt"></i> <span data-translate="stability_testing_points">Stability Testing Points</span>
                    </h3>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        ICH Q1A(R2) <span data-translate="testing_frequency">Testing Frequency</span>
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="study_duration">Study Duration (months)</label>
                        <input type="number" class="calc-input" id="studyDuration" value="36" step="1">
                    </div>
                    
                    <div>
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="study_type_select">Study Type</label>
                        <select class="calc-input" id="studyType">
                            <option value="long-term">Long Term (25°C/60% RH)</option>
                            <option value="intermediate">Intermediate (30°C/65% RH)</option>
                            <option value="accelerated">Accelerated (40°C/75% RH)</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="calculateTestingPoints()">
                        <i class="fas fa-calculator"></i> <span data-translate="calculate">Calculate</span>
                    </button>
                    
                    <div id="testingPointsResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px;">
                        <span data-translate="testing_points_result">Testing points will appear here</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Analysis Entry System -->
        <div id="analysis-entry" class="content-area">
            <h2 style="color: var(--navy); margin-bottom: 15px;">
                <i class="fas fa-file-signature"></i> <span data-translate="analysis_entry_system">Analysis Entry System</span>
            </h2>
            
            <div style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                <!-- Microbiology Requirements -->
                <div style="background: #e8f5e9; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                    <h4 style="color: #0f5132; margin-bottom: 10px;">
                        <i class="fas fa-microscope"></i> <span data-translate="microbiology_requirements">Microbiology Requirements</span>
                    </h4>
                    <div style="font-size: 14px;">
                        <span data-translate="micro_note">All materials require microbiology testing per GMP requirements:</span>
                        <ul style="margin: 10px 0 10px 20px;">
                            <li data-translate="micro_api">APIs: TAMC, TYMC, E. coli, Salmonella</li>
                            <li data-translate="micro_excipient">Excipients: TAMC, TYMC</li>
                            <li data-translate="micro_finished">Finished Products: TAMC, TYMC, Pathogens</li>
                            <li data-translate="micro_water">Water: TAMC, Endotoxins</li>
                            <li data-translate="micro_packaging">Packaging: Bioburden</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Stepper -->
                <div class="entry-stepper">
                    <div class="step active" id="step1">
                        <div class="step-number">1</div>
                        <div class="step-label" data-translate="material_info">Material Info</div>
                    </div>
                    <div class="step" id="step2">
                        <div class="step-number">2</div>
                        <div class="step-label" data-translate="tests_selection">Tests Selection</div>
                    </div>
                    <div class="step" id="step3">
                        <div class="step-number">3</div>
                        <div class="step-label" data-translate="results_entry">Results Entry</div>
                    </div>
                    <div class="step" id="step4">
                        <div class="step-number">4</div>
                        <div class="step-label" data-translate="review_submit">Review & Submit</div>
                    </div>
                </div>
                
                <!-- Step 1: Material Information -->
                <div id="section1" style="display: block;">
                    <h3 style="color: var(--navy); margin-bottom: 15px;" data-translate="material_information">Material Information</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px;" data-translate="material_type">Material Type</label>
                            <select style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px;" id="materialType">
                                <option value="">Select Type</option>
                                <option value="API">Active Pharmaceutical Ingredient (API)</option>
                                <option value="Excipient">Excipient</option>
                                <option value="Finished Product">Finished Product</option>
                                <option value="Water">Water System</option>
                                <option value="Packaging">Packaging Material</option>
                                <option value="Cleaning">Cleaning Validation</option>
                                <option value="Stability">Stability Sample</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px;" data-translate="material_name">Material Name</label>
                            <input type="text" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px;" 
                                   id="materialName" placeholder="e.g., Metronidazole BP">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px;" data-translate="batch_number">Batch/Lot Number</label>
                            <input type="text" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px;" 
                                   id="batchNumber" placeholder="e.g., BN-2025-001">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px;" data-translate="manufacturer">Manufacturer</label>
                            <input type="text" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px;" 
                                   id="manufacturer" placeholder="e.g., ABC Pharmaceuticals">
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: right;">
                        <button class="btn btn-primary" onclick="nextStep(1)">
                            <span data-translate="next">Next</span> <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Step 2: Test Selection -->
                <div id="section2" style="display: none;">
                    <h3 style="color: var(--navy); margin-bottom: 15px;" data-translate="test_selection">Test Selection</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; font-size: 14px;" data-translate="select_pharmacopoeia">Select Pharmacopoeia</label>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn" onclick="togglePharmacopoeia('BP 2025')" 
                                    style="background: #e3f2fd; color: #1565c0;">BP 2025</button>
                            <button class="btn" onclick="togglePharmacopoeia('USP 43')" 
                                    style="background: #f3e5f5; color: #7b1fa2;">USP 43</button>
                            <button class="btn" onclick="togglePharmacopoeia('Ph.Eur.')" 
                                    style="background: #e8f5e9; color: #0f5132;">Ph.Eur.</button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; font-size: 14px;" data-translate="standard_tests">Standard Tests</label>
                        <div id="standardTests" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                            <div style="background: white; border: 1px solid var(--border); border-radius: 4px; padding: 10px; cursor: pointer;"
                                 onclick="toggleTestSelection('appearance')" id="test_appearance">
                                <div style="font-weight: 600; margin-bottom: 5px;" data-translate="appearance">Appearance</div>
                                <div style="font-size: 12px; color: #666;" data-translate="appearance_desc">Visual inspection</div>
                            </div>
                            <div style="background: white; border: 1px solid var(--border); border-radius: 4px; padding: 10px; cursor: pointer;"
                                 onclick="toggleTestSelection('identification')" id="test_identification">
                                <div style="font-weight: 600; margin-bottom: 5px;" data-translate="identification">Identification</div>
                                <div style="font-size: 12px; color: #666;" data-translate="identification_desc">IR, TLC, or chemical tests</div>
                            </div>
                            <div style="background: white; border: 1px solid var(--border); border-radius: 4px; padding: 10px; cursor: pointer;"
                                 onclick="toggleTestSelection('assay')" id="test_assay">
                                <div style="font-weight: 600; margin-bottom: 5px;" data-translate="assay">Assay</div>
                                <div style="font-size: 12px; color: #666;" data-translate="assay_desc">Content determination</div>
                            </div>
                            <div style="background: white; border: 1px solid var(--border); border-radius: 4px; padding: 10px; cursor: pointer;"
                                 onclick="toggleTestSelection('related_substances')" id="test_related_substances">
                                <div style="font-weight: 600; margin-bottom: 5px;" data-translate="related_substances">Related Substances</div>
                                <div style="font-size: 12px; color: #666;" data-translate="related_substances_desc">Impurity profiling</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; font-size: 14px;" data-translate="microbiology_tests_selection">Microbiology Tests (Required)</label>
                        <div id="microbiologyTests" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                            <div style="background: #e8f5e9; border: 1px solid var(--ok); border-radius: 4px; padding: 10px; cursor: pointer;"
                                 onclick="toggleTestSelection('tamc')" id="test_tamc">
                                <div style="font-weight: 600; margin-bottom: 5px;">TAMC</div>
                                <div style="font-size: 12px; color: #666;" data-translate="tamc_desc">Total Aerobic Microbial Count</div>
                            </div>
                            <div style="background: #e8f5e9; border: 1px solid var(--ok); border-radius: 4px; padding: 10px; cursor: pointer;"
                                 onclick="toggleTestSelection('tymc')" id="test_tymc">
                                <div style="font-weight: 600; margin-bottom: 5px;">TYMC</div>
                                <div style="font-size: 12px; color: #666;" data-translate="tymc_desc">Total Yeast & Mold Count</div>
                            </div>
                            <div style="background: #e8f5e9; border: 1px solid var(--ok); border-radius: 4px; padding: 10px; cursor: pointer;"
                                 onclick="toggleTestSelection('e_coli')" id="test_e_coli">
                                <div style="font-weight: 600; margin-bottom: 5px;">E. coli</div>
                                <div style="font-size: 12px; color: #666;" data-translate="e_coli_desc">Escherichia coli</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                        <button class="btn btn-outline" onclick="previousStep(2)">
                            <i class="fas fa-arrow-left"></i> <span data-translate="back">Back</span>
                        </button>
                        <button class="btn btn-primary" onclick="nextStep(2)">
                            <span data-translate="next">Next</span> <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Step 3: Results Entry -->
                <div id="section3" style="display: none;">
                    <h3 style="color: var(--navy); margin-bottom: 15px;" data-translate="test_results_entry">Test Results Entry</h3>
                    
                    <div id="resultsEntryContainer">
                        <!-- Results will be loaded here -->
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                        <button class="btn btn-outline" onclick="previousStep(3)">
                            <i class="fas fa-arrow-left"></i> <span data-translate="back">Back</span>
                        </button>
                        <button class="btn btn-primary" onclick="nextStep(3)">
                            <span data-translate="next">Next</span> <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Step 4: Review and Submit -->
                <div id="section4" style="display: none;">
                    <h3 style="color: var(--navy); margin-bottom: 15px;" data-translate="review_submit_analysis">Review & Submit Analysis</h3>
                    
                    <div id="reviewContainer" style="background: #f8f9fa; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                        <!-- Review content will be loaded here -->
                    </div>
                    
                    <div style="display: flex; justify-content: space-between;">
                        <button class="btn btn-outline" onclick="previousStep(4)">
                            <i class="fas fa-arrow-left"></i> <span data-translate="back">Back</span>
                        </button>
                        <div>
                            <button class="btn btn-info" onclick="generateAnalysisReport()">
                                <i class="fas fa-file-pdf"></i> <span data-translate="generate_report">Generate Report</span>
                            </button>
                            <button class="btn btn-success" onclick="submitAnalysis()" style="margin-left: 10px;">
                                <i class="fas fa-check"></i> <span data-translate="submit_analysis">Submit Analysis</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- COA Generator -->
        <div id="coa-generator" class="content-area">
            <h2 style="color: var(--navy); margin-bottom: 15px;">
                <i class="fas fa-file-certificate"></i> <span data-translate="coa_generator_title">Certificate of Analysis Generator</span>
            </h2>
            
            <div class="calculation-grid">
                <!-- COA Form -->
                <div class="calc-card" style="grid-column: span 2;">
                    <h3 style="color: var(--navy); margin-bottom: 10px;">
                        <i class="fas fa-file-medical"></i> <span data-translate="coa_template">COA Template</span>
                    </h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="company_name">Company Name</label>
                        <input type="text" class="calc-input" id="companyName" value="Pharmaceutical Manufacturing Co.">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="product_name">Product Name</label>
                        <input type="text" class="calc-input" id="productName" value="Metronidazole Tablets 500mg">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="batch_number_coa">Batch Number</label>
                            <input type="text" class="calc-input" id="coaBatchNumber" value="BN-2025-001">
                        </div>
                        <div>
                            <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="manufacture_date">Manufacture Date</label>
                            <input type="date" class="calc-input" id="manufactureDate" value="${new Date().toISOString().split('T')[0]}">
                        </div>
                        <div>
                            <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="expiry_date">Expiry Date</label>
                            <input type="date" class="calc-input" id="expiryDate" value="${new Date(new Date().setFullYear(new Date().getFullYear() + 2)).toISOString().split('T')[0]}">
                        </div>
                        <div>
                            <label style="display: block; margin: 5px 0; font-size: 14px;" data-translate="release_date">Release Date</label>
                            <input type="date" class="calc-input" id="releaseDate" value="${new Date().toISOString().split('T')[0]}">
                        </div>
                    </div>
                    
                    <!-- Test Results Table -->
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: var(--navy); margin-bottom: 10px;" data-translate="test_results">Test Results</h4>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #f8f9fa;">
                                        <th style="padding: 8px; text-align: left;" data-translate="test">Test</th>
                                        <th style="padding: 8px; text-align: left;" data-translate="specification">Specification</th>
                                        <th style="padding: 8px; text-align: left;" data-translate="result">Result</th>
                                        <th style="padding: 8px; text-align: left;" data-translate="compliance">Compliance</th>
                                    </tr>
                                </thead>
                                <tbody id="coaTestResults">
                                    <tr>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;" data-translate="appearance_coa">Appearance</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;" data-translate="white_tablet">White, round tablet</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;">White, round tablet</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><span style="color: var(--ok);">✓</span></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;" data-translate="identification_coa">Identification</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;">IR spectrum matches reference</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;">Matches reference</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><span style="color: var(--ok);">✓</span></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;" data-translate="assay_coa">Assay</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;">95.0% - 105.0%</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;">99.8%</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><span style="color: var(--ok);">✓</span></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;" data-translate="content_uniformity_coa">Content Uniformity</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;">AV ≤ 15.0</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;">8.5</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><span style="color: var(--ok);">✓</span></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;" data-translate="disintegration_coa">Disintegration</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;">≤ 15 minutes</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;">8.5 minutes</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><span style="color: var(--ok);">✓</span></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;" data-translate="microbiology_coa">Microbiology</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;">TAMC ≤ 1000 cfu/g</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;">120 cfu/g</td>
                                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><span style="color: var(--ok);">✓</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- COA Actions -->
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-primary" style="width: 200px;" onclick="printCOA()">
                            <i class="fas fa-print"></i> <span data-translate="print_coa">Print COA</span>
                        </button>
                        <button class="btn btn-success" style="width: 200px; margin-left: 10px;" onclick="downloadCOA()">
                            <i class="fas fa-download"></i> <span data-translate="download_coa">Download COA</span>
                        </button>
                        <button class="btn btn-info" style="width: 200px; margin-left: 10px;" onclick="previewCOA()">
                            <i class="fas fa-eye"></i> <span data-translate="preview_coa">Preview COA</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- COA Print Preview -->
            <div id="coaPrintPreview" style="display: none; margin-top: 30px;">
                <div class="data-table-container coa-print">
                    <div style="text-align: center; border-bottom: 2px solid var(--navy); padding-bottom: 20px; margin-bottom: 30px;">
                        <h1 style="color: var(--navy);" data-translate="certificate_of_analysis">CERTIFICATE OF ANALYSIS</h1>
                        <h3 id="coaCompanyName">Pharmaceutical Manufacturing Co.</h3>
                        <div style="margin-top: 10px;">
                            <div data-translate="address">123 Quality Street, Pharmaceutical City, PC 12345</div>
                            <div>Tel: +1-234-567-8900 | Email: quality@pharmaco.com</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <table style="width: 100%;">
                            <tr>
                                <td style="width: 50%; vertical-align: top;">
                                    <div><strong data-translate="product">Product:</strong> <span id="coaProductName">Metronidazole Tablets 500mg</span></div>
                                    <div><strong data-translate="batch_no_coa">Batch Number:</strong> <span id="coaBatchNumberDisplay">BN-2025-001</span></div>
                                    <div><strong data-translate="manufacture_date_coa">Manufacture Date:</strong> <span id="coaManufactureDate">2025-01-15</span></div>
                                </td>
                                <td style="width: 50%; vertical-align: top;">
                                    <div><strong data-translate="expiry_date">Expiry Date:</strong> <span id="coaExpiryDate">2027-01-14</span></div>
                                    <div><strong data-translate="release_date">Release Date:</strong> <span id="coaReleaseDate">2025-01-20</span></div>
                                    <div><strong data-translate="coa_number">COA Number:</strong> <span id="coaNumber">COA-2025-001</span></div>
                                </td>
                            </tr>
                        </table>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h4 style="color: var(--navy); margin-bottom: 15px;" data-translate="test_results_summary">Test Results Summary</h4>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                                <thead>
                                    <tr style="background: #f8f9fa;">
                                        <th style="padding: 10px; border: 1px solid #ddd;" data-translate="test">Test</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;" data-translate="specification">Specification</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;" data-translate="result">Result</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;" data-translate="method">Method</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;" data-translate="compliance">Compliance</th>
                                    </tr>
                                </thead>
                                <tbody id="coaPrintResults">
                                    <!-- Results populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div style="margin-top: 50px;">
                        <div style="display: flex; justify-content: space-between;">
                            <div style="text-align: center;">
                                <div style="border-top: 1px solid #000; width: 200px; margin-bottom: 5px;"></div>
                                <div data-translate="analyst_signature">Analyst Signature</div>
                                <div style="font-size: 12px;">John Doe, QC Analyst</div>
                                <div style="font-size: 12px;">Date: <span id="coaAnalystDate">2025-01-20</span></div>
                            </div>
                            <div style="text-align: center;">
                                <div style="border-top: 1px solid #000; width: 200px; margin-bottom: 5px;"></div>
                                <div data-translate="qa_manager_signature">QA Manager Signature</div>
                                <div style="font-size: 12px;">Jane Smith, QA Manager</div>
                                <div style="font-size: 12px;">Date: <span id="coaQADate">2025-01-20</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 50px; font-size: 12px; color: #666; text-align: center;">
                        <div data-translate="coa_footer1">This certificate is based on tests performed on representative samples.</div>
                        <div data-translate="coa_footer2">The batch complies with current Good Manufacturing Practice (GMP) requirements.</div>
                        <div data-translate="coa_footer3">Generated by PQMS V009 - Pharmaceutical Quality Management System</div>
                        <div>Developed by Dr. Daoud Tajeldeinn Ahmed</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Reports -->
        <div id="reports" class="content-area">
            <h2 style="color: var(--navy); margin-bottom: 15px;">
                <i class="fas fa-file-pdf"></i> <span data-translate="analysis_reports">Analysis Reports</span>
            </h2>
            
            <div class="dashboard-grid">
                <div class="stat-card" onclick="generateReport('coa')" style="text-align: center;">
                    <i class="fas fa-file-certificate" style="font-size: 36px; color: var(--info); margin-bottom: 10px;"></i>
                    <h3 data-translate="certificate_analysis">Certificate of Analysis</h3>
                    <p style="color: #666; margin: 10px 0; font-size: 14px;" data-translate="coa_description">Generate COA for materials and products</p>
                </div>
                
                <div class="stat-card" onclick="generateReport('batch')" style="text-align: center;">
                    <i class="fas fa-clipboard-check" style="font-size: 36px; color: var(--ok); margin-bottom: 10px;"></i>
                    <h3 data-translate="batch_release">Batch Release Certificate</h3>
                    <p style="color: #666; margin: 10px 0; font-size: 14px;" data-translate="batch_description">Generate batch release certificates</p>
                </div>
                
                <div class="stat-card" onclick="generateReport('stability')" style="text-align: center;">
                    <i class="fas fa-chart-line" style="font-size: 36px; color: var(--purple); margin-bottom: 10px;"></i>
                    <h3 data-translate="stability_report">Stability Report</h3>
                    <p style="color: #666; margin: 10px 0; font-size: 14px;" data-translate="stability_description">Generate stability study reports</p>
                </div>
                
                <div class="stat-card" onclick="generateReport('summary')" style="text-align: center;">
                    <i class="fas fa-chart-bar" style="font-size: 36px; color: var(--warn); margin-bottom: 10px;"></i>
                    <h3 data-translate="summary_report">Summary Report</h3>
                    <p style="color: #666; margin: 10px 0; font-size: 14px;" data-translate="summary_description">Generate monthly summary reports</p>
                </div>
            </div>
            
            <!-- Recent Reports -->
            <div class="data-table-container" style="margin-top: 20px;">
                <h3 style="color: var(--navy); margin-bottom: 15px;" data-translate="recent_reports">Recent Reports</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th data-translate="report_type">Report Type</th>
                            <th data-translate="reference">Reference</th>
                            <th data-translate="date_generated">Date Generated</th>
                            <th data-translate="generated_by">Generated By</th>
                            <th data-translate="actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="recentReportsTable">
                        <tr>
                            <td>Certificate of Analysis</td>
                            <td>COA-2025-001</td>
                            <td>2025-01-20</td>
                            <td>QC Analyst</td>
                            <td>
                                <button class="btn btn-sm" style="padding: 4px 8px; font-size: 12px;" onclick="printReport('COA-2025-001')">
                                    <i class="fas fa-print"></i>
                                </button>
                                <button class="btn btn-sm" style="padding: 4px 8px; font-size: 12px; margin-left: 5px;" onclick="downloadReport('COA-2025-001')">
                                    <i class="fas fa-download"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td>Batch Release Certificate</td>
                            <td>BRC-2025-001</td>
                            <td>2025-01-19</td>
                            <td>QA Manager</td>
                            <td>
                                <button class="btn btn-sm" style="padding: 4px 8px; font-size: 12px;" onclick="printReport('BRC-2025-001')">
                                    <i class="fas fa-print"></i>
                                </button>
                                <button class="btn btn-sm" style="padding: 4px 8px; font-size: 12px; margin-left: 5px;" onclick="downloadReport('BRC-2025-001')">
                                    <i class="fas fa-download"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script>
        // ===== GLOBAL VARIABLES =====
        let currentLanguage = 'en';
        let currentStep = 1;
        let selectedPharmacopoeia = [];
        let selectedTests = [];
        let analysisData = {};
        
        // ===== TRANSLATIONS =====
        const translations = {
            en: {
                // System
                system_title: "PQMS V009 - Enhanced",
                system_subtitle: "Pharmaceutical Quality Management System",
                developed_by: "Developed by",
                status: "Status",
                online: "Online",
                user: "User",
                quality_manager: "Quality Manager",
                
                // Navigation
                dashboard: "Dashboard",
                ipqc_calculations: "IPQC Calculations",
                granulation: "Granulation",
                compression: "Compression",
                sachet_filling: "Sachet Filling",
                analysis_entry: "Analysis Entry",
                coa_generator: "COA Generator",
                reports: "Reports",
                microbiology: "Microbiology",
                stability: "Stability",
                
                // Dashboard
                quality_dashboard: "Quality Dashboard",
                quality_compliance: "Quality Compliance",
                active_ipqc: "Active IPQC Tests",
                completed_tests: "Completed Tests",
                microbiology_tests: "Microbiology Tests",
                recent_analyses: "Recent Completed Analyses",
                certificate_analysis: "Certificate of Analysis",
                coa_description: "Generate COA for materials",
                
                // Common
                material: "Material",
                batch_no: "Batch No.",
                test_type: "Test Type",
                completed_date: "Completed Date",
                actions: "Actions",
                calculate: "Calculate",
                result: "Result",
                pass: "Pass",
                fail: "Fail",
                save: "Save",
                cancel: "Cancel",
                next: "Next",
                back: "Back",
                print: "Print",
                download: "Download",
                preview: "Preview",
                
                // IPQC
                ipqc_calculations_title: "IPQC Calculations (BP/USP Compliance)",
                tablet_weight_var: "Tablet Weight Variation",
                uniformity_dosage: "Uniformity of Dosage Units",
                avg_weight: "Average Weight (mg)",
                individual_weights: "Individual Weights (mg, comma separated)",
                result_appear: "Result will appear here",
                content_uniformity: "Content Uniformity",
                content_uniformity_test: "Content Uniformity Test",
                assay_results: "Assay Results (%, comma separated)",
                acceptance_value: "Acceptance Value (AV) will appear here",
                disintegration_test: "Disintegration Test",
                disintegration: "Disintegration",
                disintegration_times: "Disintegration Times (minutes, comma separated)",
                specification_limit: "Specification Limit (minutes)",
                disintegration_result: "Disintegration test result will appear here",
                friability_test: "Friability Test",
                tablet_friability: "Tablet Friability",
                initial_weight: "Initial Weight (g)",
                final_weight: "Final Weight (g)",
                friability_percentage: "Friability percentage will appear here",
                hardness_test: "Hardness Test",
                tablet_breaking: "Tablet Breaking Force",
                hardness_values: "Hardness Values (kp, comma separated)",
                hardness_spec: "Hardness Specification (kp)",
                hardness_result: "Hardness results will appear here",
                thickness_diameter: "Thickness & Diameter",
                dimensional_tests: "Dimensional Tests",
                thickness_values: "Thickness Values (mm, comma separated)",
                diameter_values: "Diameter Values (mm, comma separated)",
                dimensions_result: "Thickness & diameter results will appear here",
                
                // GMP Parameters
                gmp_parameters: "GMP/GDP Parameter Limits",
                parameter: "Parameter",
                bp_limit: "BP Limit",
                usp_limit: "USP Limit",
                eu_limit: "Ph.Eur. Limit",
                acceptance_criteria: "Acceptance Criteria",
                gdp_compliance: "GDP Compliance",
                weight_var_tablets: "Weight Variation (Tablets ≥ 250mg)",
                weight_criteria: "Not more than 2 tablets outside ±10%, none outside ±20%",
                content_uniformity_av: "Content Uniformity (AV)",
                content_criteria: "Stage 1: AV ≤ 15.0, Stage 2: AV ≤ 25.0",
                disintegration_uncoated: "Disintegration (Uncoated Tablets)",
                disintegration_criteria: "All tablets disintegrate completely",
                friability: "Friability",
                friability_criteria: "If >1.0%, repeat test on 3 additional samples",
                hardness: "Hardness",
                hardness_criteria: "Product specific, maintain consistent hardness",
                thickness: "Thickness",
                thickness_criteria: "Individual variation ±5%, average ±3%",
                diameter: "Diameter",
                diameter_criteria: "For tablets > 10mm: ±0.5mm, < 10mm: ±0.3mm",
                dissolution: "Dissolution",
                dissolution_criteria: "Stage 1: All units ≥ Q+5%, Stage 2: Average ≥ Q",
                
                // Granulation
                granulation_calculations: "Granulation Calculations",
                granulation_gmp: "Granulation GMP Parameters",
                powder_flowability: "Powder Flowability",
                powder_flow: "Powder Flow",
                heap_height: "Heap Height (cm)",
                heap_diameter: "Heap Diameter (cm)",
                flow_time: "Flow Time (seconds)",
                powder_weight: "Powder Weight (g)",
                flowability_result: "Flowability results will appear here",
                tap_density: "Tap Density",
                bulk_density: "Bulk Density and Tapped Density",
                initial_volume: "Initial Volume (mL)",
                tapped_volume: "Tapped Volume (mL)",
                sample_weight_tap: "Sample Weight (g)",
                tap_density_result: "Tap density results will appear here",
                particle_size_dist: "Particle Size Distribution",
                light_diffraction: "Light Diffraction Measurement",
                d10: "D10 (µm)",
                d50: "D50 (µm)",
                d90: "D90 (µm)",
                psd_result: "Particle size results will appear here",
                distribution_factor: "Distribution Factor",
                uniformity_index: "Uniformity Index Calculation",
                particle_sizes: "Particle Sizes (µm, comma separated)",
                target_size: "Target Size (µm)",
                distribution_result: "Distribution factor will appear here",
                powder_flow_rate: "Powder Flow Rate",
                angle_repose: "Angle of Repose",
                bulk_density_table: "Bulk Density",
                tapped_density: "Tapped Density",
                compressibility_index: "Compressibility Index",
                hausner_ratio: "Hausner Ratio",
                particle_size_d10: "Particle Size D10",
                particle_size_d50: "Particle Size D50",
                particle_size_d90: "Particle Size D90",
                acceptance_limit: "Acceptance Limit",
                action_limit: "Action Limit",
                testing_frequency: "Testing Frequency",
                
                // Compression
                compression_parameters: "Compression Parameters",
                compression_gmp: "Compression GMP Parameters",
                compression_force: "Compression Force",
                machine_settings: "Machine Settings Analysis",
                upper_punch: "Upper Punch Force (kN)",
                lower_punch: "Lower Punch Force (kN)",
                ejection_force: "Ejection Force (kN)",
                compression_result: "Compression force results will appear here",
                compression_ratio: "Compression Ratio",
                powder_characteristics: "Powder Characteristics Analysis",
                bulk_density_comp: "Bulk Density (g/mL)",
                tablet_density: "Tablet Density (g/mL)",
                die_fill_depth: "Die Fill Depth (mm)",
                tablet_thickness_comp: "Tablet Thickness (mm)",
                compression_ratio_result: "Compression ratio results will appear here",
                tablet_porosity: "Tablet Porosity",
                porosity_calculation: "Porosity Calculation",
                true_density: "True Density (g/mL)",
                apparent_density: "Apparent Density (g/mL)",
                tablet_weight_porosity: "Tablet Weight (mg)",
                porosity_result: "Porosity results will appear here",
                compression_force_param: "Compression Force",
                ejection_force_param: "Ejection Force",
                pre_compression: "Pre-compression Force",
                compression_speed: "Compression Speed",
                dwell_time: "Dwell Time",
                tablet_weight_comp: "Tablet Weight",
                tablet_hardness_comp: "Tablet Hardness",
                tablet_thickness_param: "Tablet Thickness",
                tablet_diameter_param: "Tablet Diameter",
                
                // Sachet Filling
                sachet_filling_calc: "Sachet Filling Calculations",
                sachet_weight_var: "Sachet Weight Variation",
                powder_uniformity: "Powder Uniformity",
                target_sachet_weight: "Target Sachet Weight (g)",
                sachet_weights: "Sachet Weights (g, comma separated)",
                sachet_limit: "Acceptance Limit (%)",
                sachet_result: "Sachet weight results will appear here",
                seal_integrity: "Seal Integrity",
                seal_strength: "Seal Strength Testing",
                seal_strength_values: "Seal Strength Values (N/15mm, comma separated)",
                minimum_seal: "Minimum Seal Strength (N/15mm)",
                seal_result: "Seal integrity results will appear here",
                fill_accuracy: "Fill Accuracy",
                filling_validation: "Filling Machine Validation",
                fill_weights: "Fill Weights (g, comma separated)",
                fill_spec: "Fill Specification (±g)",
                fill_result: "Fill accuracy results will appear here",
                
                // Microbiology
                microbiology_requirements_table: "Microbiology Requirements by Material Type",
                required_tests: "Required Tests",
                frequency: "Frequency",
                api_micro: "Active Pharmaceutical Ingredients (APIs)",
                excipients_micro: "Excipients",
                finished_products_micro: "Finished Products (Oral)",
                sterile_products: "Sterile Products",
                water_systems: "Water Systems",
                packaging_materials: "Packaging Materials",
                microbial_count: "Microbial Count Calculation",
                microbial_enumeration: "Microbial Enumeration Tests",
                colony_count: "Colony Count",
                dilution_factor: "Dilution Factor",
                sample_volume: "Sample Volume (mL/g)",
                microbial_result: "Microbial count results will appear here",
                endotoxin_calculation: "Endotoxin Calculation",
                bacterial_endotoxins: "Bacterial Endotoxins Test",
                sample_endotoxin: "Sample Endotoxin (EU/mL)",
                maximum_dose: "Maximum Dose (mL/kg)",
                endotoxin_limit: "Endotoxin Limit (EU/kg)",
                endotoxin_result: "Endotoxin calculation results will appear here",
                
                // Stability
                stability_studies: "Stability Studies",
                stability_conditions: "ICH Stability Testing Conditions",
                study_type: "Study Type",
                storage_condition: "Storage Condition",
                minimum_duration: "Minimum Duration",
                application: "Application",
                ich_guideline: "ICH Guideline",
                long_term: "Long Term",
                climatic_zone: "Climatic Zone II",
                intermediate: "Intermediate",
                climatic_zone_iii: "Climatic Zone III/IV",
                accelerated: "Accelerated",
                supporting_data: "Supporting data",
                refrigerated: "Refrigerated",
                cold_products: "Cold chain products",
                freezer: "Freezer",
                frozen_products: "Frozen products",
                shelf_life_calculator: "Shelf Life Calculator",
                evaluation_stability: "Evaluation of Stability Data",
                assay_initial: "Initial Assay (%)",
                assay_12m: "Assay at 12 months (%)",
                assay_spec: "Assay Specification (%)",
                degradation_rate: "Degradation Rate (%/month)",
                shelf_life_result: "Shelf life results will appear here",
                stability_testing_points: "Stability Testing Points",
                testing_frequency_stability: "Testing Frequency",
                study_duration: "Study Duration (months)",
                study_type_select: "Study Type",
                testing_points_result: "Testing points will appear here",
                
                // Analysis Entry
                analysis_entry_system: "Analysis Entry System",
                microbiology_requirements: "Microbiology Requirements",
                micro_note: "All materials require microbiology testing per GMP requirements:",
                micro_api: "APIs: TAMC, TYMC, E. coli, Salmonella",
                micro_excipient: "Excipients: TAMC, TYMC",
                micro_finished: "Finished Products: TAMC, TYMC, Pathogens",
                micro_water: "Water: TAMC, Endotoxins",
                micro_packaging: "Packaging: Bioburden",
                material_info: "Material Info",
                tests_selection: "Tests Selection",
                results_entry: "Results Entry",
                review_submit: "Review & Submit",
                material_information: "Material Information",
                material_type: "Material Type",
                material_name: "Material Name",
                batch_number: "Batch/Lot Number",
                manufacturer: "Manufacturer",
                test_selection: "Test Selection",
                select_pharmacopoeia: "Select Pharmacopoeia",
                standard_tests: "Standard Tests",
                appearance: "Appearance",
                appearance_desc: "Visual inspection",
                identification: "Identification",
                identification_desc: "IR, TLC, or chemical tests",
                assay: "Assay",
                assay_desc: "Content determination",
                related_substances: "Related Substances",
                related_substances_desc: "Impurity profiling",
                microbiology_tests_selection: "Microbiology Tests (Required)",
                tamc_desc: "Total Aerobic Microbial Count",
                tymc_desc: "Total Yeast & Mold Count",
                e_coli_desc: "Escherichia coli",
                test_results_entry: "Test Results Entry",
                review_submit_analysis: "Review & Submit Analysis",
                generate_report: "Generate Report",
                submit_analysis: "Submit Analysis",
                
                // COA Generator
                coa_generator_title: "Certificate of Analysis Generator",
                coa_template: "COA Template",
                company_name: "Company Name",
                product_name: "Product Name",
                batch_number_coa: "Batch Number",
                manufacture_date: "Manufacture Date",
                expiry_date: "Expiry Date",
                release_date: "Release Date",
                test_results: "Test Results",
                test: "Test",
                specification: "Specification",
                compliance: "Compliance",
                appearance_coa: "Appearance",
                white_tablet: "White, round tablet",
                identification_coa: "Identification",
                assay_coa: "Assay",
                content_uniformity_coa: "Content Uniformity",
                disintegration_coa: "Disintegration",
                microbiology_coa: "Microbiology",
                print_coa: "Print COA",
                download_coa: "Download COA",
                preview_coa: "Preview COA",
                certificate_of_analysis: "CERTIFICATE OF ANALYSIS",
                address: "123 Quality Street, Pharmaceutical City, PC 12345",
                product: "Product",
                batch_no_coa: "Batch Number",
                manufacture_date_coa: "Manufacture Date",
                coa_number: "COA Number",
                test_results_summary: "Test Results Summary",
                method: "Method",
                analyst_signature: "Analyst Signature",
                qa_manager_signature: "QA Manager Signature",
                coa_footer1: "This certificate is based on tests performed on representative samples.",
                coa_footer2: "The batch complies with current Good Manufacturing Practice (GMP) requirements.",
                coa_footer3: "Generated by PQMS V009 - Pharmaceutical Quality Management System",
                
                // Reports
                analysis_reports: "Analysis Reports",
                batch_release: "Batch Release Certificate",
                batch_description: "Generate batch release certificates",
                stability_report: "Stability Report",
                stability_description: "Generate stability study reports",
                summary_report: "Summary Report",
                summary_description: "Generate monthly summary reports",
                recent_reports: "Recent Reports",
                report_type: "Report Type",
                reference: "Reference",
                date_generated: "Date Generated",
                generated_by: "Generated By"
            },
            ar: {
                // System
                system_title: "نظام إدارة الجودة الصيدلانية V009 - المحسن",
                system_subtitle: "نظام إدارة الجودة الصيدلانية",
                developed_by: "تم التطوير بواسطة",
                status: "الحالة",
                online: "متصل",
                user: "المستخدم",
                quality_manager: "مدير الجودة",
                
                // Navigation
                dashboard: "لوحة التحكم",
                ipqc_calculations: "حسابات التحكم في عملية الإنتاج",
                granulation: "التجانس",
                compression: "الضغط",
                sachet_filling: "تعبئة الأكياس",
                analysis_entry: "إدخال التحليل",
                coa_generator: "مولد شهادة التحليل",
                reports: "التقارير",
                microbiology: "الميكروبيولوجيا",
                stability: "الاستقرار",
                
                // Dashboard
                quality_dashboard: "لوحة تحكم الجودة",
                quality_compliance: "الامتثال للجودة",
                active_ipqc: "اختبارات IPQC النشطة",
                completed_tests: "الاختبارات المكتملة",
                microbiology_tests: "اختبارات الميكروبيولوجيا",
                recent_analyses: "التحليلات المكتملة حديثاً",
                certificate_analysis: "شهادة التحليل",
                coa_description: "إنشاء شهادات التحليل للمواد",
                
                // Common
                material: "المادة",
                batch_no: "رقم الدفعة",
                test_type: "نوع الاختبار",
                completed_date: "تاريخ الإكمال",
                actions: "الإجراءات",
                calculate: "احسب",
                result: "النتيجة",
                pass: "مقبول",
                fail: "مرفوض",
                save: "حفظ",
                cancel: "إلغاء",
                next: "التالي",
                back: "رجوع",
                print: "طباعة",
                download: "تنزيل",
                preview: "معاينة",
                
                // IPQC
                ipqc_calculations_title: "حسابات IPQC (متوافق مع BP/USP)",
                tablet_weight_var: "تباين وزن الأقراص",
                uniformity_dosage: "توحيد وحدات الجرعة",
                avg_weight: "متوسط الوزن (ملغم)",
                individual_weights: "أوزان فردية (ملغم، مفصولة بفواصل)",
                result_appear: "ستظهر النتيجة هنا",
                content_uniformity: "توحيد المحتوى",
                content_uniformity_test: "اختبار توحيد المحتوى",
                assay_results: "نتائج المعايرة (٪، مفصولة بفواصل)",
                acceptance_value: "سيظهر قيمة القبول (AV) هنا",
                disintegration_test: "اختبار التفكك",
                disintegration: "التفكك",
                disintegration_times: "أوقات التفكك (دقائق، مفصولة بفواصل)",
                specification_limit: "حد المواصفات (دقائق)",
                disintegration_result: "ستظهر نتيجة اختبار التفكك هنا",
                friability_test: "اختبار الهشاشة",
                tablet_friability: "هشاشة الأقراص",
                initial_weight: "الوزن الأولي (غ)",
                final_weight: "الوزن النهائي (غ)",
                friability_percentage: "ستظهر نسبة الهشاشة هنا",
                hardness_test: "اختبار الصلابة",
                tablet_breaking: "قوة كسر الأقراص",
                hardness_values: "قيم الصلابة (كيلو بوند، مفصولة بفواصل)",
                hardness_spec: "مواصفات الصلابة (كيلو بوند)",
                hardness_result: "ستظهر نتائج الصلابة هنا",
                thickness_diameter: "السماكة والقطر",
                dimensional_tests: "اختبارات الأبعاد",
                thickness_values: "قيم السماكة (مم، مفصولة بفواصل)",
                diameter_values: "قيم القطر (مم، مفصولة بفواصل)",
                dimensions_result: "ستظهر نتائج السماكة والقطر هنا",
                
                // GMP Parameters
                gmp_parameters: "حدود معاملات GMP/GDP",
                parameter: "المعامل",
                bp_limit: "حد BP",
                usp_limit: "حد USP",
                eu_limit: "حد Ph.Eur.",
                acceptance_criteria: "معايير القبول",
                gdp_compliance: "امتثال GDP",
                weight_var_tablets: "تباين الوزن (أقراص ≥ 250ملغم)",
                weight_criteria: "لا يزيد عن قرصين خارج ±10٪، ولا شيء خارج ±20٪",
                content_uniformity_av: "توحيد المحتوى (AV)",
                content_criteria: "المرحلة 1: AV ≤ 15.0، المرحلة 2: AV ≤ 25.0",
                disintegration_uncoated: "التفكك (أقراص غير مغلفة)",
                disintegration_criteria: "جميع الأقراص تتفكك بالكامل",
                friability: "الهشاشة",
                friability_criteria: "إذا >1.0٪، كرر الاختبار على 3 عينات إضافية",
                hardness: "الصلابة",
                hardness_criteria: "خاص بالمنتج، الحفاظ على صلابة متسقة",
                thickness: "السماكة",
                thickness_criteria: "تباين فردي ±5٪، متوسط ±3٪",
                diameter: "القطر",
                diameter_criteria: "للأقراص > 10مم: ±0.5مم، < 10مم: ±0.3مم",
                dissolution: "الانحلال",
                dissolution_criteria: "المرحلة 1: جميع الوحدات ≥ Q+5٪، المرحلة 2: المتوسط ≥ Q",
                
                // Granulation
                granulation_calculations: "حسابات التجانس",
                granulation_gmp: "معاملات التجانس لـGMP",
                powder_flowability: "سيولة المسحوق",
                powder_flow: "تدفق المسحوق",
                heap_height: "ارتفاع الكومة (سم)",
                heap_diameter: "قطر الكومة (سم)",
                flow_time: "وقت التدفق (ثواني)",
                powder_weight: "وزن المسحوق (غ)",
                flowability_result: "ستظهر نتائج السيولة هنا",
                tap_density: "الكثافة المدقوقة",
                bulk_density: "الكثافة السائبة والكثافة المدقوقة",
                initial_volume: "الحجم الأولي (مل)",
                tapped_volume: "الحجم المدقوق (مل)",
                sample_weight_tap: "وزن العينة (غ)",
                tap_density_result: "ستظهر نتائج الكثافة المدقوقة هنا",
                particle_size_dist: "توزيع حجم الجسيمات",
                light_diffraction: "قياس حيود الضوء",
                d10: "D10 (ميكرون)",
                d50: "D50 (ميكرون)",
                d90: "D90 (ميكرون)",
                psd_result: "ستظهر نتائج حجم الجسيمات هنا",
                distribution_factor: "عامل التوزيع",
                uniformity_index: "حساب مؤشر التوحيد",
                particle_sizes: "أحجام الجسيمات (ميكرون، مفصولة بفواصل)",
                target_size: "الحجم المستهدف (ميكرون)",
                distribution_result: "سيظهر عامل التوزيع هنا",
                powder_flow_rate: "معدل تدفق المسحوق",
                angle_repose: "زاوية الراحة",
                bulk_density_table: "الكثافة السائبة",
                tapped_density: "الكثافة المدقوقة",
                compressibility_index: "مؤشر الانضغاطية",
                hausner_ratio: "نسبة هاوسنر",
                particle_size_d10: "حجم الجسيمات D10",
                particle_size_d50: "حجم الجسيمات D50",
                particle_size_d90: "حجم الجسيمات D90",
                acceptance_limit: "حد القبول",
                action_limit: "حد الإجراء",
                testing_frequency: "تكرار الاختبار",
                
                // Compression
                compression_parameters: "معاملات الضغط",
                compression_gmp: "معاملات الضغط لـGMP",
                compression_force: "قوة الضغط",
                machine_settings: "تحليل إعدادات الماكينة",
                upper_punch: "قوة اللكمة العلوية (كيلو نيوتن)",
                lower_punch: "قوة اللكمة السفلية (كيلو نيوتن)",
                ejection_force: "قوة الإخراج (كيلو نيوتن)",
                compression_result: "ستظهر نتائج قوة الضغط هنا",
                compression_ratio: "نسبة الضغط",
                powder_characteristics: "تحليل خصائص المسحوق",
                bulk_density_comp: "الكثافة السائبة (غ/مل)",
                tablet_density: "كثافة القرص (غ/مل)",
                die_fill_depth: "عمق تعبئة القالب (مم)",
                tablet_thickness_comp: "سمك القرص (مم)",
                compression_ratio_result: "ستظهر نتائج نسبة الضغط هنا",
                tablet_porosity: "مسامية الأقراص",
                porosity_calculation: "حساب المسامية",
                true_density: "الكثافة الحقيقية (غ/مل)",
                apparent_density: "الكثافة الظاهرية (غ/مل)",
                tablet_weight_porosity: "وزن القرص (ملغم)",
                porosity_result: "ستظهر نتائج المسامية هنا",
                compression_force_param: "قوة الضغط",
                ejection_force_param: "قوة الإخراج",
                pre_compression: "قوة الضغط المسبق",
                compression_speed: "سرعة الضغط",
                dwell_time: "زمة التماس",
                tablet_weight_comp: "وزن القرص",
                tablet_hardness_comp: "صلابة القرص",
                tablet_thickness_param: "سمك القرص",
                tablet_diameter_param: "قطر القرص",
                
                // Sachet Filling
                sachet_filling_calc: "حسابات تعبئة الأكياس",
                sachet_weight_var: "تباين وزن الأكياس",
                powder_uniformity: "توحيد المسحوق",
                target_sachet_weight: "الوزن المستهدف للكيس (غ)",
                sachet_weights: "أوزان الأكياس (غ، مفصولة بفواصل)",
                sachet_limit: "حد القبول (٪)",
                sachet_result: "ستظهر نتائج وزن الأكياس هنا",
                seal_integrity: "سلامة الختم",
                seal_strength: "اختبار قوة الختم",
                seal_strength_values: "قيم قوة الختم (نيوتن/15مم، مفصولة بفواصل)",
                minimum_seal: "أقل قوة ختم (نيوتن/15مم)",
                seal_result: "ستظهر نتائج سلامة الختم هنا",
                fill_accuracy: "دقة التعبئة",
                filling_validation: "التحقق من آلة التعبئة",
                fill_weights: "أوزان التعبئة (غ، مفصولة بفواصل)",
                fill_spec: "مواصفات التعبئة (±غ)",
                fill_result: "ستظهر نتائج دقة التعبئة هنا",
                
                // Microbiology
                microbiology_requirements_table: "متطلبات الميكروبيولوجيا حسب نوع المادة",
                required_tests: "الاختبارات المطلوبة",
                frequency: "التكرار",
                api_micro: "المواد الفعالة الصيدلانية (APIs)",
                excipients_micro: "المواد المساعدة",
                finished_products_micro: "المنتجات النهائية (فموية)",
                sterile_products: "المنتجات المعقمة",
                water_systems: "أنظمة المياه",
                packaging_materials: "مواد التعبئة والتغليف",
                microbial_count: "حساب العد الميكروبي",
                microbial_enumeration: "اختبارات العد الميكروبي",
                colony_count: "عدد المستعمرات",
                dilution_factor: "عامل التخفيف",
                sample_volume: "حجم العينة (مل/غ)",
                microbial_result: "ستظهر نتائج العد الميكروبي هنا",
                endotoxin_calculation: "حساب السموم الداخلية",
                bacterial_endotoxins: "اختبار السموم الداخلية البكتيرية",
                sample_endotoxin: "السموم الداخلية في العينة (وحدة أوروبية/مل)",
                maximum_dose: "الجرعة القصوى (مل/كغ)",
                endotoxin_limit: "حد السموم الداخلية (وحدة أوروبية/كغ)",
                endotoxin_result: "ستظهر نتائج حساب السموم الداخلية هنا",
                
                // Stability
                stability_studies: "دراسات الاستقرار",
                stability_conditions: "ظروف اختبار الاستقرار حسب ICH",
                study_type: "نوع الدراسة",
                storage_condition: "ظروف التخزين",
                minimum_duration: "المدة الدنيا",
                application: "التطبيق",
                ich_guideline: "دليل ICH",
                long_term: "طويل الأمد",
                climatic_zone: "المنطقة المناخية II",
                intermediate: "متوسط",
                climatic_zone_iii: "المنطقة المناخية III/IV",
                accelerated: "مسرع",
                supporting_data: "بيانات داعمة",
                refrigerated: "مبرد",
                cold_products: "منتجات السلسلة الباردة",
                freezer: "مجمد",
                frozen_products: "منتجات مجمدة",
                shelf_life_calculator: "حاسبة مدة الصلاحية",
                evaluation_stability: "تقييم بيانات الاستقرار",
                assay_initial: "المعايرة الأولية (٪)",
                assay_12m: "المعايرة عند 12 شهراً (٪)",
                assay_spec: "مواصفات المعايرة (٪)",
                degradation_rate: "معدل التحلل (٪/شهر)",
                shelf_life_result: "ستظهر نتائج مدة الصلاحية هنا",
                stability_testing_points: "نقاط اختبار الاستقرار",
                testing_frequency_stability: "تكرار الاختبار",
                study_duration: "مدة الدراسة (أشهر)",
                study_type_select: "نوع الدراسة",
                testing_points_result: "ستظهر نقاط الاختبار هنا",
                
                // Analysis Entry
                analysis_entry_system: "نظام إدخال التحليل",
                microbiology_requirements: "متطلبات الميكروبيولوجيا",
                micro_note: "جميع المواد تتطلب اختبارات ميكروبيولوجية وفقاً لمتطلبات GMP:",
                micro_api: "المواد الفعالة: TAMC, TYMC, E. coli, Salmonella",
                micro_excipient: "المساعدات: TAMC, TYMC",
                micro_finished: "المنتجات النهائية: TAMC, TYMC, مسببات الأمراض",
                micro_water: "الماء: TAMC, السموم الداخلية",
                micro_packaging: "مواد التعبئة: الحمل الحيوي",
                material_info: "معلومات المادة",
                tests_selection: "اختيار الاختبارات",
                results_entry: "إدخال النتائج",
                review_submit: "المراجعة والإرسال",
                material_information: "معلومات المادة",
                material_type: "نوع المادة",
                material_name: "اسم المادة",
                batch_number: "رقم الدفعة/اللوت",
                manufacturer: "الشركة المصنعة",
                test_selection: "اختيار الاختبارات",
                select_pharmacopoeia: "اختيار الدستور الدوائي",
                standard_tests: "الاختبارات القياسية",
                appearance: "المظهر",
                appearance_desc: "فحص بصري",
                identification: "التعريف",
                identification_desc: "اختبارات IR أو TLC أو كيميائية",
                assay: "المعايرة",
                assay_desc: "تحديد المحتوى",
                related_substances: "المواد ذات الصلة",
                related_substances_desc: "تحليل الشوائب",
                microbiology_tests_selection: "اختبارات الميكروبيولوجيا (مطلوبة)",
                tamc_desc: "إجمالي عدد الميكروبات الهوائية",
                tymc_desc: "إجمالي عدد الخمائر والعفن",
                e_coli_desc: "الإشريكية القولونية",
                test_results_entry: "إدخال نتائج الاختبارات",
                review_submit_analysis: "مراجعة وإرسال التحليل",
                generate_report: "إنشاء تقرير",
                submit_analysis: "إرسال التحليل",
                
                // COA Generator
                coa_generator_title: "مولد شهادة التحليل",
                coa_template: "نموذج COA",
                company_name: "اسم الشركة",
                product_name: "اسم المنتج",
                batch_number_coa: "رقم الدفعة",
                manufacture_date: "تاريخ التصنيع",
                expiry_date: "تاريخ الانتهاء",
                release_date: "تاريخ الإصدار",
                test_results: "نتائج الاختبارات",
                test: "الاختبار",
                specification: "المواصفات",
                compliance: "الامتثال",
                appearance_coa: "المظهر",
                white_tablet: "قرص أبيض دائري",
                identification_coa: "التعريف",
                assay_coa: "المعايرة",
                content_uniformity_coa: "توحيد المحتوى",
                disintegration_coa: "التفكك",
                microbiology_coa: "الميكروبيولوجيا",
                print_coa: "طباعة COA",
                download_coa: "تنزيل COA",
                preview_coa: "معاينة COA",
                certificate_of_analysis: "شهادة التحليل",
                address: "شارع الجودة 123، مدينة الصيدلة، الرمز البريدي 12345",
                product: "المنتج",
                batch_no_coa: "رقم الدفعة",
                manufacture_date_coa: "تاريخ التصنيع",
                coa_number: "رقم شهادة التحليل",
                test_results_summary: "ملخص نتائج الاختبارات",
                method: "الطريقة",
                analyst_signature: "توقيع المحلل",
                qa_manager_signature: "توقيع مدير الجودة",
                coa_footer1: "تستند هذه الشهادة إلى اختبارات أجريت على عينات ممثلة.",
                coa_footer2: "تتوافق الدفعة مع متطلبات ممارسات التصنيع الجيدة الحالية (GMP).",
                coa_footer3: "تم إنشاؤها بواسطة PQMS V009 - نظام إدارة الجودة الصيدلانية",
                
                // Reports
                analysis_reports: "تقارير التحليل",
                batch_release: "شهادة إصدار الدفعة",
                batch_description: "إنشاء شهادات إصدار الدفعة",
                stability_report: "تقرير الثبات",
                stability_description: "إنشاء تقارير دراسة الثبات",
                summary_report: "تقرير الملخص",
                summary_description: "إنشاء تقارير ملخص شهرية",
                recent_reports: "التقارير الحديثة",
                report_type: "نوع التقرير",
                reference: "المرجع",
                date_generated: "تاريخ الإنشاء",
                generated_by: "تم الإنشاء بواسطة"
            }
        };
        
        // ===== LANGUAGE FUNCTIONS =====
        function switchLanguage(lang) {
            currentLanguage = lang;
            document.body.classList.toggle('rtl', lang === 'ar');
            
            // Update language buttons
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update all translatable elements
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            showToast(lang === 'en' ? 'Language switched to English' : 'تم تغيير اللغة إلى العربية', 'success');
        }
        
        // ===== TAB MANAGEMENT =====
        function showTab(tabId) {
            // Hide all content areas
            document.querySelectorAll('.content-area').forEach(area => {
                area.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(nav => {
                nav.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            
            // Add active class to clicked nav tab
            event.target.closest('.nav-tab').classList.add('active');
            
            // Initialize calculators if specific tab is shown
            if (tabId === 'ipqc-calculations') {
                initializeIPQCCalculators();
            } else if (tabId === 'granulation') {
                initializeGranulationCalculators();
            } else if (tabId === 'compression') {
                initializeCompressionCalculators();
            }
        }
        
        // ===== CALCULATION FUNCTIONS =====
        function initializeIPQCCalculators() {
            // Initialize all IPQC calculators with default values
            calculateWeightVariation();
            calculateContentUniformity();
            calculateDisintegration();
            calculateFriability();
            calculateHardness();
            calculateDimensions();
        }
        
        function initializeGranulationCalculators() {
            calculateFlowability();
            calculateTapDensity();
            calculatePSD();
            calculateDistributionFactor();
        }
        
        function initializeCompressionCalculators() {
            calculateCompressionForce();
            calculateCompressionRatio();
            calculatePorosity();
        }
        
        function calculateWeightVariation() {
            const avgWeight = parseFloat(document.getElementById('avgTabletWeight').value) || 0;
            const weightsInput = document.getElementById('individualWeights').value;
            const weights = weightsInput.split(',').map(w => parseFloat(w.trim())).filter(w => !isNaN(w));
            
            if (weights.length === 0 || avgWeight <= 0) {
                document.getElementById('weightVariationResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            let variations = [];
            let outsideLimit5 = 0;
            let outsideLimit10 = 0;
            let outsideLimit20 = 0;
            
            weights.forEach(weight => {
                const variation = Math.abs(weight - avgWeight) / avgWeight * 100;
                variations.push(variation);
                
                if (variation > 5) outsideLimit5++;
                if (variation > 10) outsideLimit10++;
                if (variation > 20) outsideLimit20++;
            });
            
            let result = '';
            let status = 'pass';
            
            if (outsideLimit20 > 0) {
                result = `<span style="color: var(--bad);">❌ ${currentLanguage === 'en' ? 'FAIL' : 'مرفوض'} - ${outsideLimit20} ${currentLanguage === 'en' ? 'tablets exceed ±20% limit' : 'قرص يتجاوز حد ±20%'}</span>`;
                status = 'fail';
            } else if (outsideLimit10 > 2) {
                result = `<span style="color: var(--bad);">❌ ${currentLanguage === 'en' ? 'FAIL' : 'مرفوض'} - ${outsideLimit10} ${currentLanguage === 'en' ? 'tablets exceed ±10% limit (max 2 allowed)' : 'قرص يتجاوز حد ±10% (الحد الأقصى المسموح به 2)'}</span>`;
                status = 'fail';
            } else if (outsideLimit5 > 0) {
                result = `<span style="color: var(--warn);">⚠ ${currentLanguage === 'en' ? 'WARNING' : 'تحذير'} - ${outsideLimit5} ${currentLanguage === 'en' ? 'tablets exceed ±5% limit but within acceptance' : 'قرص يتجاوز حد ±5% ولكن ضمن القبول'}</span>`;
                status = 'warning';
            } else {
                result = `<span style="color: var(--ok);">✅ ${currentLanguage === 'en' ? 'PASS' : 'مقبول'} - ${currentLanguage === 'en' ? 'All tablets within ±5% limit' : 'جميع الأقراص ضمن حد ±5%'}</span>`;
                status = 'pass';
            }
            
            document.getElementById('weightVariationResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Average Weight:' : 'متوسط الوزن:'}</strong> ${avgWeight} mg</div>
                <div><strong>${currentLanguage === 'en' ? 'Number of Tablets:' : 'عدد الأقراص:'}</strong> ${weights.length}</div>
                <div><strong>${currentLanguage === 'en' ? 'Outside ±5%:' : 'خارج ±5%:'}</strong> ${outsideLimit5}</div>
                <div><strong>${currentLanguage === 'en' ? 'Outside ±10%:' : 'خارج ±10%:'}</strong> ${outsideLimit10}</div>
                <div><strong>${currentLanguage === 'en' ? 'Outside ±20%:' : 'خارج ±20%:'}</strong> ${outsideLimit20}</div>
                <div style="margin-top: 5px;"><strong>${currentLanguage === 'en' ? 'Result:' : 'النتيجة:'}</strong> ${result}</div>
            `;
        }
        
        function calculateContentUniformity() {
            const assayInput = document.getElementById('assayResults').value;
            const assays = assayInput.split(',').map(a => parseFloat(a.trim())).filter(a => !isNaN(a));
            
            if (assays.length < 10) {
                document.getElementById('contentUniformityResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter at least 10 assay results' : 'يرجى إدخال 10 نتائج معايرة على الأقل'}</span>`;
                return;
            }
            
            const mean = assays.reduce((sum, val) => sum + val, 0) / assays.length;
            const variance = assays.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / assays.length;
            const stdDev = Math.sqrt(variance);
            
            const referenceValue = 100;
            const k = 2.4;
            const AV = Math.abs(referenceValue - mean) + k * stdDev;
            
            let result = '';
            
            if (AV <= 15) {
                result = `<span style="color: var(--ok);">✅ ${currentLanguage === 'en' ? 'PASS' : 'مقبول'} - ${currentLanguage === 'en' ? 'Acceptance Value (AV)' : 'قيمة القبول (AV)'}=${AV.toFixed(2)} ≤ 15.0 (${currentLanguage === 'en' ? 'Stage 1' : 'المرحلة الأولى'})</span>`;
            } else if (AV <= 25) {
                result = `<span style="color: var(--warn);">⚠ ${currentLanguage === 'en' ? 'CONDITIONAL' : 'مشروط'} - ${currentLanguage === 'en' ? 'Acceptance Value (AV)' : 'قيمة القبول (AV)'}=${AV.toFixed(2)}, ${currentLanguage === 'en' ? 'requires Stage 2 testing' : 'يتطلب اختبار المرحلة الثانية'}</span>`;
            } else {
                result = `<span style="color: var(--bad);">❌ ${currentLanguage === 'en' ? 'FAIL' : 'مرفوض'} - ${currentLanguage === 'en' ? 'Acceptance Value (AV)' : 'قيمة القبول (AV)'}=${AV.toFixed(2)} > 25.0</span>`;
            }
            
            document.getElementById('contentUniformityResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Average:' : 'المتوسط:'}</strong> ${mean.toFixed(2)}%</div>
                <div><strong>${currentLanguage === 'en' ? 'Standard Deviation:' : 'الانحراف المعياري:'}</strong> ${stdDev.toFixed(2)}</div>
                <div><strong>${currentLanguage === 'en' ? 'Acceptance Value (AV):' : 'قيمة القبول (AV):'}</strong> ${AV.toFixed(2)}</div>
                <div style="margin-top: 5px;"><strong>${currentLanguage === 'en' ? 'Result:' : 'النتيجة:'}</strong> ${result}</div>
            `;
        }
        
        function calculateDisintegration() {
            const timesInput = document.getElementById('disintegrationTimes').value;
            const times = timesInput.split(',').map(t => parseFloat(t.trim())).filter(t => !isNaN(t));
            const limit = parseFloat(document.getElementById('disintegrationLimit').value) || 15;
            
            if (times.length === 0) {
                document.getElementById('disintegrationResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const maxTime = Math.max(...times);
            const allWithinLimit = times.every(time => time <= limit);
            
            let result = '';
            
            if (allWithinLimit) {
                result = `<span style="color: var(--ok);">✅ ${currentLanguage === 'en' ? 'PASS' : 'مقبول'} - ${currentLanguage === 'en' ? 'All tablets disintegrate completely within' : 'جميع الأقراص تتفكك بالكامل خلال'} ${limit} ${currentLanguage === 'en' ? 'minutes' : 'دقيقة'}</span>`;
            } else {
                const outsideLimit = times.filter(time => time > limit).length;
                result = `<span style="color: var(--bad);">❌ ${currentLanguage === 'en' ? 'FAIL' : 'مرفوض'} - ${outsideLimit} ${currentLanguage === 'en' ? 'tablets exceed' : 'قرص يتجاوز'} ${limit} ${currentLanguage === 'en' ? 'minute limit, maximum disintegration time:' : 'دقيقة حد، أقصى وقت تفكك:'} ${maxTime.toFixed(1)} ${currentLanguage === 'en' ? 'minutes' : 'دقيقة'}</span>`;
            }
            
            document.getElementById('disintegrationResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Number of Tablets Tested:' : 'عدد الأقراص المختبرة:'}</strong> ${times.length}</div>
                <div><strong>${currentLanguage === 'en' ? 'Maximum Disintegration Time:' : 'أقصى وقت تفكك:'}</strong> ${maxTime.toFixed(1)} ${currentLanguage === 'en' ? 'minutes' : 'دقيقة'}</div>
                <div><strong>${currentLanguage === 'en' ? 'Limit:' : 'الحد:'}</strong> ≤ ${limit} ${currentLanguage === 'en' ? 'minutes' : 'دقيقة'}</div>
                <div style="margin-top: 5px;"><strong>${currentLanguage === 'en' ? 'Result:' : 'النتيجة:'}</strong> ${result}</div>
            `;
        }
        
        function calculateFriability() {
            const initial = parseFloat(document.getElementById('initialFriabilityWeight').value) || 0;
            const final = parseFloat(document.getElementById('finalFriabilityWeight').value) || 0;
            
            if (initial <= 0 || final <= 0) {
                document.getElementById('friabilityResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const loss = initial - final;
            const percentage = (loss / initial) * 100;
            
            let result = '';
            
            if (percentage <= 1.0) {
                result = `<span style="color: var(--ok);">✅ ${currentLanguage === 'en' ? 'PASS' : 'مقبول'} - ${currentLanguage === 'en' ? 'Friability loss' : 'فقد الهشاشة'} ${percentage.toFixed(2)}% ≤ 1.0%</span>`;
            } else if (percentage <= 1.5) {
                result = `<span style="color: var(--warn);">⚠ ${currentLanguage === 'en' ? 'RETEST REQUIRED' : 'يتطلب إعادة اختبار'} - ${currentLanguage === 'en' ? 'Friability loss' : 'فقد الهشاشة'} ${percentage.toFixed(2)}% > 1.0%, ${currentLanguage === 'en' ? 'retest required' : 'يتطلب إعادة اختبار'}</span>`;
            } else {
                result = `<span style="color: var(--bad);">❌ ${currentLanguage === 'en' ? 'FAIL' : 'مرفوض'} - ${currentLanguage === 'en' ? 'Friability loss' : 'فقد الهشاشة'} ${percentage.toFixed(2)}% > 1.5%</span>`;
            }
            
            document.getElementById('friabilityResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Initial Weight:' : 'الوزن الأولي:'}</strong> ${initial.toFixed(3)} g</div>
                <div><strong>${currentLanguage === 'en' ? 'Final Weight:' : 'الوزن النهائي:'}</strong> ${final.toFixed(3)} g</div>
                <div><strong>${currentLanguage === 'en' ? 'Weight Loss:' : 'فقد الوزن:'}</strong> ${loss.toFixed(3)} g</div>
                <div><strong>${currentLanguage === 'en' ? 'Friability:' : 'الهشاشة:'}</strong> ${percentage.toFixed(2)}%</div>
                <div style="margin-top: 5px;"><strong>${currentLanguage === 'en' ? 'Result:' : 'النتيجة:'}</strong> ${result}</div>
            `;
        }
        
        function calculateHardness() {
            const hardnessInput = document.getElementById('hardnessValues').value;
            const hardnessValues = hardnessInput.split(',').map(h => parseFloat(h.trim())).filter(h => !isNaN(h));
            
            if (hardnessValues.length === 0) {
                document.getElementById('hardnessResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const hardnessSpec = document.getElementById('hardnessSpec').value;
            const specParts = hardnessSpec.split('-');
            let minHardness = 4, maxHardness = 10;
            
            if (specParts.length === 2) {
                minHardness = parseFloat(specParts[0]);
                maxHardness = parseFloat(specParts[1]);
            }
            
            const mean = hardnessValues.reduce((sum, val) => sum + val, 0) / hardnessValues.length;
            const min = Math.min(...hardnessValues);
            const max = Math.max(...hardnessValues);
            
            let allWithinSpec = true;
            let belowMin = 0;
            let aboveMax = 0;
            
            hardnessValues.forEach(value => {
                if (value < minHardness) {
                    allWithinSpec = false;
                    belowMin++;
                }
                if (value > maxHardness) {
                    allWithinSpec = false;
                    aboveMax++;
                }
            });
            
            let result = '';
            
            if (allWithinSpec) {
                result = `<span style="color: var(--ok);">✅ ${currentLanguage === 'en' ? 'PASS' : 'مقبول'} - ${currentLanguage === 'en' ? 'All tablets within hardness specification' : 'جميع الأقراص ضمن مواصفات الصلابة'}</span>`;
            } else {
                result = `<span style="color: var(--bad);">❌ ${currentLanguage === 'en' ? 'FAIL' : 'مرفوض'} - ${belowMin} ${currentLanguage === 'en' ? 'tablets below minimum, ' : 'قرص تحت الحد الأدنى، '} ${aboveMax} ${currentLanguage === 'en' ? 'above maximum' : 'فوق الحد الأقصى'}</span>`;
            }
            
            document.getElementById('hardnessResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Average Hardness:' : 'متوسط الصلابة:'}</strong> ${mean.toFixed(2)} kp</div>
                <div><strong>${currentLanguage === 'en' ? 'Minimum:' : 'الحد الأدنى:'}</strong> ${min.toFixed(2)} kp</div>
                <div><strong>${currentLanguage === 'en' ? 'Maximum:' : 'الحد الأقصى:'}</strong> ${max.toFixed(2)} kp</div>
                <div><strong>${currentLanguage === 'en' ? 'Specification:' : 'المواصفات:'}</strong> ${minHardness}-${maxHardness} kp</div>
                <div style="margin-top: 5px;"><strong>${currentLanguage === 'en' ? 'Result:' : 'النتيجة:'}</strong> ${result}</div>
            `;
        }
        
        function calculateDimensions() {
            const thicknessInput = document.getElementById('thicknessValues').value;
            const diameterInput = document.getElementById('diameterValues').value;
            
            const thicknessValues = thicknessInput.split(',').map(t => parseFloat(t.trim())).filter(t => !isNaN(t));
            const diameterValues = diameterInput.split(',').map(d => parseFloat(d.trim())).filter(d => !isNaN(d));
            
            if (thicknessValues.length === 0 || diameterValues.length === 0) {
                document.getElementById('dimensionsResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const thicknessMean = thicknessValues.reduce((sum, val) => sum + val, 0) / thicknessValues.length;
            const thicknessMin = Math.min(...thicknessValues);
            const thicknessMax = Math.max(...thicknessValues);
            
            const diameterMean = diameterValues.reduce((sum, val) => sum + val, 0) / diameterValues.length;
            const diameterMin = Math.min(...diameterValues);
            const diameterMax = Math.max(...diameterValues);
            
            document.getElementById('dimensionsResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Thickness Analysis:' : 'تحليل السماكة:'}</strong></div>
                <div><strong>${currentLanguage === 'en' ? 'Average:' : 'المتوسط:'}</strong> ${thicknessMean.toFixed(2)} mm</div>
                <div><strong>${currentLanguage === 'en' ? 'Range:' : 'المدى:'}</strong> ${thicknessMin.toFixed(2)} - ${thicknessMax.toFixed(2)} mm</div>
                <div><strong>${currentLanguage === 'en' ? 'Variation:' : 'التباين:'}</strong> ${((thicknessMax - thicknessMin) / thicknessMean * 100).toFixed(1)}%</div>
                
                <div style="margin-top: 10px;"><strong>${currentLanguage === 'en' ? 'Diameter Analysis:' : 'تحليل القطر:'}</strong></div>
                <div><strong>${currentLanguage === 'en' ? 'Average:' : 'المتوسط:'}</strong> ${diameterMean.toFixed(2)} mm</div>
                <div><strong>${currentLanguage === 'en' ? 'Range:' : 'المدى:'}</strong> ${diameterMin.toFixed(2)} - ${diameterMax.toFixed(2)} mm</div>
                <div><strong>${currentLanguage === 'en' ? 'Variation:' : 'التباين:'}</strong> ${((diameterMax - diameterMin) / diameterMean * 100).toFixed(1)}%</div>
            `;
        }
        
        function calculateFlowability() {
            const heapHeight = parseFloat(document.getElementById('heapHeight').value) || 0;
            const heapDiameter = parseFloat(document.getElementById('heapDiameter').value) || 0;
            const flowTime = parseFloat(document.getElementById('flowTime').value) || 0;
            const powderWeight = parseFloat(document.getElementById('powderWeight').value) || 0;
            
            if (heapHeight <= 0 || heapDiameter <= 0 || flowTime <= 0 || powderWeight <= 0) {
                document.getElementById('flowabilityResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const angleOfRepose = Math.atan(heapHeight / (heapDiameter / 2)) * (180 / Math.PI);
            const flowRate = powderWeight / flowTime;
            
            let flowabilityRating = '';
            let color = '';
            
            if (angleOfRepose < 25) {
                flowabilityRating = currentLanguage === 'en' ? 'Excellent' : 'ممتازة';
                color = 'var(--ok)';
            } else if (angleOfRepose < 30) {
                flowabilityRating = currentLanguage === 'en' ? 'Good' : 'جيدة';
                color = 'var(--ok)';
            } else if (angleOfRepose < 35) {
                flowabilityRating = currentLanguage === 'en' ? 'Fair' : 'متوسطة';
                color = 'var(--warn)';
            } else if (angleOfRepose < 40) {
                flowabilityRating = currentLanguage === 'en' ? 'Passable' : 'مقبولة';
                color = 'var(--warn)';
            } else {
                flowabilityRating = currentLanguage === 'en' ? 'Poor' : 'ضعيفة';
                color = 'var(--bad)';
            }
            
            document.getElementById('flowabilityResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Angle of Repose:' : 'زاوية الراحة:'}</strong> ${angleOfRepose.toFixed(1)}°</div>
                <div><strong>${currentLanguage === 'en' ? 'Flow Rate:' : 'معدل التدفق:'}</strong> ${flowRate.toFixed(2)} g/sec</div>
                <div style="margin-top: 5px;"><strong>${currentLanguage === 'en' ? 'Flowability Rating:' : 'تصنيف السيولة:'}</strong> <span style="color: ${color}; font-weight: 600;">${flowabilityRating}</span></div>
                <div style="font-size: 12px; color: #666; margin-top: 5px;">
                    ${currentLanguage === 'en' 
                        ? 'Acceptance criteria: Angle of repose ≤ 35°' 
                        : 'معايير القبول: زاوية الراحة ≤ 35°'}
                </div>
            `;
        }
        
        function calculateTapDensity() {
            const initialVolume = parseFloat(document.getElementById('initialVolume').value) || 0;
            const tappedVolume = parseFloat(document.getElementById('tappedVolume').value) || 0;
            const sampleWeight = parseFloat(document.getElementById('sampleWeightTap').value) || 0;
            
            if (initialVolume <= 0 || tappedVolume <= 0 || sampleWeight <= 0) {
                document.getElementById('tapDensityResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const bulkDensity = sampleWeight / initialVolume;
            const tappedDensity = sampleWeight / tappedVolume;
            const compressibilityIndex = ((tappedVolume - initialVolume) / tappedVolume) * 100;
            const hausnerRatio = tappedDensity / bulkDensity;
            
            let flowability = '';
            let color = '';
            
            if (compressibilityIndex <= 10) {
                flowability = currentLanguage === 'en' ? 'Excellent' : 'ممتازة';
                color = 'var(--ok)';
            } else if (compressibilityIndex <= 15) {
                flowability = currentLanguage === 'en' ? 'Good' : 'جيدة';
                color = 'var(--ok)';
            } else if (compressibilityIndex <= 20) {
                flowability = currentLanguage === 'en' ? 'Fair' : 'متوسطة';
                color = 'var(--warn)';
            } else if (compressibilityIndex <= 35) {
                flowability = currentLanguage === 'en' ? 'Passable' : 'مقبولة';
                color = 'var(--warn)';
            } else {
                flowability = currentLanguage === 'en' ? 'Poor' : 'ضعيفة';
                color = 'var(--bad)';
            }
            
            document.getElementById('tapDensityResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Bulk Density:' : 'الكثافة السائبة:'}</strong> ${bulkDensity.toFixed(3)} g/mL</div>
                <div><strong>${currentLanguage === 'en' ? 'Tapped Density:' : 'الكثافة المدقوقة:'}</strong> ${tappedDensity.toFixed(3)} g/mL</div>
                <div><strong>${currentLanguage === 'en' ? 'Compressibility Index:' : 'مؤشر الانضغاطية:'}</strong> ${compressibilityIndex.toFixed(1)}%</div>
                <div><strong>${currentLanguage === 'en' ? 'Hausner Ratio:' : 'نسبة هاوسنر:'}</strong> ${hausnerRatio.toFixed(3)}</div>
                <div style="margin-top: 5px;"><strong>${currentLanguage === 'en' ? 'Flowability:' : 'السيولة:'}</strong> <span style="color: ${color}; font-weight: 600;">${flowability}</span></div>
            `;
        }
        
        function calculatePSD() {
            const d10 = parseFloat(document.getElementById('d10').value) || 0;
            const d50 = parseFloat(document.getElementById('d50').value) || 0;
            const d90 = parseFloat(document.getElementById('d90').value) || 0;
            
            if (d10 <= 0 || d50 <= 0 || d90 <= 0) {
                document.getElementById('psdResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const span = (d90 - d10) / d50;
            
            let uniformity = '';
            let color = '';
            
            if (span < 0.5) {
                uniformity = currentLanguage === 'en' ? 'Excellent' : 'ممتاز';
                color = 'var(--ok)';
            } else if (span < 1.0) {
                uniformity = currentLanguage === 'en' ? 'Good' : 'جيد';
                color = 'var(--ok)';
            } else if (span < 1.5) {
                uniformity = currentLanguage === 'en' ? 'Fair' : 'متوسط';
                color = 'var(--warn)';
            } else {
                uniformity = currentLanguage === 'en' ? 'Poor' : 'ضعيف';
                color = 'var(--bad)';
            }
            
            document.getElementById('psdResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'D10:' : 'D10:'}</strong> ${d10.toFixed(1)} µm</div>
                <div><strong>${currentLanguage === 'en' ? 'D50:' : 'D50:'}</strong> ${d50.toFixed(1)} µm</div>
                <div><strong>${currentLanguage === 'en' ? 'D90:' : 'D90:'}</strong> ${d90.toFixed(1)} µm</div>
                <div><strong>${currentLanguage === 'en' ? 'Span:' : 'المدى:'}</strong> ${span.toFixed(3)}</div>
                <div style="margin-top: 5px;"><strong>${currentLanguage === 'en' ? 'Uniformity:' : 'التوحيد:'}</strong> <span style="color: ${color}; font-weight: 600;">${uniformity}</span></div>
            `;
        }
        
        function calculateDistributionFactor() {
            const particleSizesInput = document.getElementById('particleSizes').value;
            const particleSizes = particleSizesInput.split(',').map(p => parseFloat(p.trim())).filter(p => !isNaN(p));
            const targetSize = parseFloat(document.getElementById('targetSize').value) || 0;
            
            if (particleSizes.length === 0 || targetSize <= 0) {
                document.getElementById('distributionResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const mean = particleSizes.reduce((sum, val) => sum + val, 0) / particleSizes.length;
            const variance = particleSizes.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / particleSizes.length;
            const stdDev = Math.sqrt(variance);
            
            const distributionFactor = (stdDev / mean) * 100;
            
            let quality = '';
            let color = '';
            
            if (distributionFactor < 10) {
                quality = currentLanguage === 'en' ? 'Excellent' : 'ممتاز';
                color = 'var(--ok)';
            } else if (distributionFactor < 20) {
                quality = currentLanguage === 'en' ? 'Good' : 'جيد';
                color = 'var(--ok)';
            } else if (distributionFactor < 30) {
                quality = currentLanguage === 'en' ? 'Acceptable' : 'مقبول';
                color = 'var(--warn)';
            } else {
                quality = currentLanguage === 'en' ? 'Poor' : 'ضعيف';
                color = 'var(--bad)';
            }
            
            document.getElementById('distributionResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Number of Particles:' : 'عدد الجسيمات:'}</strong> ${particleSizes.length}</div>
                <div><strong>${currentLanguage === 'en' ? 'Mean Particle Size:' : 'متوسط حجم الجسيمات:'}</strong> ${mean.toFixed(1)} µm</div>
                <div><strong>${currentLanguage === 'en' ? 'Standard Deviation:' : 'الانحراف المعياري:'}</strong> ${stdDev.toFixed(2)}</div>
                <div><strong>${currentLanguage === 'en' ? 'Distribution Factor:' : 'عامل التوزيع:'}</strong> ${distributionFactor.toFixed(1)}%</div>
                <div style="margin-top: 5px;"><strong>${currentLanguage === 'en' ? 'Distribution Quality:' : 'جودة التوزيع:'}</strong> <span style="color: ${color}; font-weight: 600;">${quality}</span></div>
            `;
        }
        
        function calculateCompressionForce() {
            const upperPunch = parseFloat(document.getElementById('upperPunch').value) || 0;
            const lowerPunch = parseFloat(document.getElementById('lowerPunch').value) || 0;
            const ejectionForce = parseFloat(document.getElementById('ejectionForce').value) || 0;
            
            if (upperPunch <= 0 || lowerPunch <= 0) {
                document.getElementById('compressionResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const totalForce = upperPunch + lowerPunch;
            const forceRatio = upperPunch / lowerPunch;
            
            let compressionStatus = '';
            let color = '';
            
            if (totalForce >= 20 && totalForce <= 40 && forceRatio >= 1.5 && forceRatio <= 2.5) {
                compressionStatus = currentLanguage === 'en' ? 'Optimal' : 'مثالي';
                color = 'var(--ok)';
            } else if (totalForce >= 15 && totalForce <= 45) {
                compressionStatus = currentLanguage === 'en' ? 'Acceptable' : 'مقبول';
                color = 'var(--warn)';
            } else {
                compressionStatus = currentLanguage === 'en' ? 'Adjust Required' : 'يتطلب ضبط';
                color = 'var(--bad)';
            }
            
            let ejectionStatus = '';
            let ejectionColor = '';
            
            if (ejectionForce <= 2) {
                ejectionStatus = currentLanguage === 'en' ? 'Good' : 'جيد';
                ejectionColor = 'var(--ok)';
            } else if (ejectionForce <= 3) {
                ejectionStatus = currentLanguage === 'en' ? 'Acceptable' : 'مقبول';
                ejectionColor = 'var(--warn)';
            } else {
                ejectionStatus = currentLanguage === 'en' ? 'Too High' : 'مرتفع جداً';
                ejectionColor = 'var(--bad)';
            }
            
            document.getElementById('compressionResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Total Compression Force:' : 'إجمالي قوة الضغط:'}</strong> ${totalForce.toFixed(1)} kN</div>
                <div><strong>${currentLanguage === 'en' ? 'Force Ratio (Upper/Lower):' : 'نسبة القوة (علوي/سفلي):'}</strong> ${forceRatio.toFixed(2)}</div>
                <div><strong>${currentLanguage === 'en' ? 'Ejection Force:' : 'قوة الإخراج:'}</strong> ${ejectionForce.toFixed(1)} kN</div>
                <div style="margin-top: 5px;">
                    <strong>${currentLanguage === 'en' ? 'Compression Status:' : 'حالة الضغط:'}</strong> 
                    <span style="color: ${color}; font-weight: 600;">${compressionStatus}</span>
                </div>
                <div>
                    <strong>${currentLanguage === 'en' ? 'Ejection Status:' : 'حالة الإخراج:'}</strong> 
                    <span style="color: ${ejectionColor}; font-weight: 600;">${ejectionStatus}</span>
                </div>
            `;
        }
        
        function calculateCompressionRatio() {
            const bulkDensity = parseFloat(document.getElementById('bulkDensityComp').value) || 0;
            const tabletDensity = parseFloat(document.getElementById('tabletDensity').value) || 0;
            const dieFillDepth = parseFloat(document.getElementById('dieFillDepth').value) || 0;
            const tabletThickness = parseFloat(document.getElementById('tabletThicknessComp').value) || 0;
            
            if (bulkDensity <= 0 || tabletDensity <= 0 || dieFillDepth <= 0 || tabletThickness <= 0) {
                document.getElementById('compressionRatioResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const compressionRatio = dieFillDepth / tabletThickness;
            const densityRatio = tabletDensity / bulkDensity;
            
            let compressionStatus = '';
            let color = '';
            
            if (compressionRatio >= 3.5 && compressionRatio <= 4.5) {
                compressionStatus = currentLanguage === 'en' ? 'Optimal' : 'مثالي';
                color = 'var(--ok)';
            } else if (compressionRatio >= 3.0 && compressionRatio <= 5.0) {
                compressionStatus = currentLanguage === 'en' ? 'Acceptable' : 'مقبول';
                color = 'var(--warn)';
            } else {
                compressionStatus = currentLanguage === 'en' ? 'Adjust Required' : 'يتطلب ضبط';
                color = 'var(--bad)';
            }
            
            document.getElementById('compressionRatioResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Compression Ratio:' : 'نسبة الضغط:'}</strong> ${compressionRatio.toFixed(2)}</div>
                <div><strong>${currentLanguage === 'en' ? 'Density Ratio:' : 'نسبة الكثافة:'}</strong> ${densityRatio.toFixed(2)}</div>
                <div><strong>${currentLanguage === 'en' ? 'Bulk Density:' : 'الكثافة السائبة:'}</strong> ${bulkDensity.toFixed(3)} g/mL</div>
                <div><strong>${currentLanguage === 'en' ? 'Tablet Density:' : 'كثافة القرص:'}</strong> ${tabletDensity.toFixed(3)} g/mL</div>
                <div style="margin-top: 5px;">
                    <strong>${currentLanguage === 'en' ? 'Compression Status:' : 'حالة الضغط:'}</strong> 
                    <span style="color: ${color}; font-weight: 600;">${compressionStatus}</span>
                </div>
            `;
        }
        
        function calculatePorosity() {
            const trueDensity = parseFloat(document.getElementById('trueDensity').value) || 0;
            const apparentDensity = parseFloat(document.getElementById('apparentDensity').value) || 0;
            const tabletWeight = parseFloat(document.getElementById('tabletWeightPorosity').value) || 0;
            
            if (trueDensity <= 0 || apparentDensity <= 0 || tabletWeight <= 0) {
                document.getElementById('porosityResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const porosity = (1 - (apparentDensity / trueDensity)) * 100;
            const tabletVolume = tabletWeight / 1000 / apparentDensity;
            
            let porosityStatus = '';
            let color = '';
            
            if (porosity >= 5 && porosity <= 15) {
                porosityStatus = currentLanguage === 'en' ? 'Optimal' : 'مثالي';
                color = 'var(--ok)';
            } else if (porosity >= 3 && porosity <= 20) {
                porosityStatus = currentLanguage === 'en' ? 'Acceptable' : 'مقبول';
                color = 'var(--warn)';
            } else {
                porosityStatus = currentLanguage === 'en' ? 'Adjust Required' : 'يتطلب ضبط';
                color = 'var(--bad)';
            }
            
            document.getElementById('porosityResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'True Density:' : 'الكثافة الحقيقية:'}</strong> ${trueDensity.toFixed(3)} g/mL</div>
                <div><strong>${currentLanguage === 'en' ? 'Apparent Density:' : 'الكثافة الظاهرية:'}</strong> ${apparentDensity.toFixed(3)} g/mL</div>
                <div><strong>${currentLanguage === 'en' ? 'Porosity:' : 'المسامية:'}</strong> ${porosity.toFixed(1)}%</div>
                <div><strong>${currentLanguage === 'en' ? 'Tablet Volume:' : 'حجم القرص:'}</strong> ${tabletVolume.toFixed(3)} mL</div>
                <div style="margin-top: 5px;">
                    <strong>${currentLanguage === 'en' ? 'Porosity Status:' : 'حالة المسامية:'}</strong> 
                    <span style="color: ${color}; font-weight: 600;">${porosityStatus}</span>
                </div>
            `;
        }
        
        function calculateSachetWeight() {
            const targetWeight = parseFloat(document.getElementById('targetSachetWeight').value) || 0;
            const weightsInput = document.getElementById('sachetWeights').value;
            const limit = parseFloat(document.getElementById('sachetLimit').value) || 10;
            
            const weights = weightsInput.split(',').map(w => parseFloat(w.trim())).filter(w => !isNaN(w));
            
            if (weights.length === 0 || targetWeight <= 0) {
                document.getElementById('sachetWeightResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const mean = weights.reduce((sum, val) => sum + val, 0) / weights.length;
            const variations = weights.map(w => Math.abs(w - targetWeight) / targetWeight * 100);
            const maxVariation = Math.max(...variations);
            const minVariation = Math.min(...variations);
            
            let outsideLimit = 0;
            weights.forEach(weight => {
                const variation = Math.abs(weight - targetWeight) / targetWeight * 100;
                if (variation > limit) outsideLimit++;
            });
            
            let result = '';
            
            if (outsideLimit === 0) {
                result = `<span style="color: var(--ok);">✅ ${currentLanguage === 'en' ? 'PASS' : 'مقبول'} - ${currentLanguage === 'en' ? 'All sachets within acceptance limit' : 'جميع الأكياس ضمن حد القبول'}</span>`;
            } else {
                result = `<span style="color: var(--bad);">❌ ${currentLanguage === 'en' ? 'FAIL' : 'مرفوض'} - ${outsideLimit} ${currentLanguage === 'en' ? 'sachets exceed' : 'كيس يتجاوز'} ${limit}% ${currentLanguage === 'en' ? 'limit' : 'حد'}</span>`;
            }
            
            document.getElementById('sachetWeightResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Target Weight:' : 'الوزن المستهدف:'}</strong> ${targetWeight.toFixed(2)} g</div>
                <div><strong>${currentLanguage === 'en' ? 'Average Weight:' : 'متوسط الوزن:'}</strong> ${mean.toFixed(2)} g</div>
                <div><strong>${currentLanguage === 'en' ? 'Weight Variation:' : 'تباين الوزن:'}</strong> ${minVariation.toFixed(1)}% - ${maxVariation.toFixed(1)}%</div>
                <div><strong>${currentLanguage === 'en' ? 'Acceptance Limit:' : 'حد القبول:'}</strong> ±${limit}%</div>
                <div><strong>${currentLanguage === 'en' ? 'Outside Limit:' : 'خارج الحد:'}</strong> ${outsideLimit}</div>
                <div style="margin-top: 5px;"><strong>${currentLanguage === 'en' ? 'Result:' : 'النتيجة:'}</strong> ${result}</div>
            `;
        }
        
        function calculateSealIntegrity() {
            const sealStrengthInput = document.getElementById('sealStrengthValues').value;
            const minSealStrength = parseFloat(document.getElementById('minSealStrength').value) || 0;
            
            const sealStrengths = sealStrengthInput.split(',').map(s => parseFloat(s.trim())).filter(s => !isNaN(s));
            
            if (sealStrengths.length === 0 || minSealStrength <= 0) {
                document.getElementById('sealResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const mean = sealStrengths.reduce((sum, val) => sum + val, 0) / sealStrengths.length;
            const min = Math.min(...sealStrengths);
            const max = Math.max(...sealStrengths);
            
            let belowMin = 0;
            sealStrengths.forEach(strength => {
                if (strength < minSealStrength) belowMin++;
            });
            
            let result = '';
            
            if (belowMin === 0) {
                result = `<span style="color: var(--ok);">✅ ${currentLanguage === 'en' ? 'PASS' : 'مقبول'} - ${currentLanguage === 'en' ? 'All seals meet minimum strength requirement' : 'جميع الأختام تفي بمتطلبات القوة الدنيا'}</span>`;
            } else {
                result = `<span style="color: var(--bad);">❌ ${currentLanguage === 'en' ? 'FAIL' : 'مرفوض'} - ${belowMin} ${currentLanguage === 'en' ? 'seals below minimum strength' : 'ختم أقل من القوة الدنيا'}</span>`;
            }
            
            document.getElementById('sealResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Average Seal Strength:' : 'متوسط قوة الختم:'}</strong> ${mean.toFixed(1)} N/15mm</div>
                <div><strong>${currentLanguage === 'en' ? 'Range:' : 'المدى:'}</strong> ${min.toFixed(1)} - ${max.toFixed(1)} N/15mm</div>
                <div><strong>${currentLanguage === 'en' ? 'Minimum Requirement:' : 'الحد الأدنى المطلوب:'}</strong> ${minSealStrength.toFixed(1)} N/15mm</div>
                <div><strong>${currentLanguage === 'en' ? 'Below Minimum:' : 'أقل من الحد الأدنى:'}</strong> ${belowMin}</div>
                <div style="margin-top: 5px;"><strong>${currentLanguage === 'en' ? 'Result:' : 'النتيجة:'}</strong> ${result}</div>
            `;
        }
        
        function calculateFillAccuracy() {
            const fillWeightsInput = document.getElementById('fillWeights').value;
            const fillSpec = parseFloat(document.getElementById('fillSpec').value) || 0;
            
            const fillWeights = fillWeightsInput.split(',').map(w => parseFloat(w.trim())).filter(w => !isNaN(w));
            
            if (fillWeights.length === 0 || fillSpec <= 0) {
                document.getElementById('fillResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const mean = fillWeights.reduce((sum, val) => sum + val, 0) / fillWeights.length;
            const stdDev = Math.sqrt(fillWeights.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / fillWeights.length);
            
            const cp = (fillSpec * 2) / (6 * stdDev);
            const cpk = Math.min(
                (fillSpec - Math.abs(mean - (mean - fillSpec))) / (3 * stdDev),
                (fillSpec - Math.abs((mean + fillSpec) - mean)) / (3 * stdDev)
            );
            
            let accuracyStatus = '';
            let color = '';
            
            if (cp >= 1.33 && cpk >= 1.33) {
                accuracyStatus = currentLanguage === 'en' ? 'Excellent' : 'ممتاز';
                color = 'var(--ok)';
            } else if (cp >= 1.0 && cpk >= 1.0) {
                accuracyStatus = currentLanguage === 'en' ? 'Acceptable' : 'مقبول';
                color = 'var(--warn)';
            } else {
                accuracyStatus = currentLanguage === 'en' ? 'Poor - Adjustment Required' : 'ضعيف - يتطلب ضبط';
                color = 'var(--bad)';
            }
            
            document.getElementById('fillResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Average Fill Weight:' : 'متوسط وزن التعبئة:'}</strong> ${mean.toFixed(3)} g</div>
                <div><strong>${currentLanguage === 'en' ? 'Standard Deviation:' : 'الانحراف المعياري:'}</strong> ${stdDev.toFixed(4)} g</div>
                <div><strong>${currentLanguage === 'en' ? 'Cp:' : 'Cp:'}</strong> ${cp.toFixed(2)}</div>
                <div><strong>${currentLanguage === 'en' ? 'Cpk:' : 'Cpk:'}</strong> ${cpk.toFixed(2)}</div>
                <div><strong>${currentLanguage === 'en' ? 'Specification:' : 'المواصفات:'}</strong> ±${fillSpec.toFixed(2)} g</div>
                <div style="margin-top: 5px;">
                    <strong>${currentLanguage === 'en' ? 'Fill Accuracy:' : 'دقة التعبئة:'}</strong> 
                    <span style="color: ${color}; font-weight: 600;">${accuracyStatus}</span>
                </div>
            `;
        }
        
        function calculateMicrobialCount() {
            const colonyCount = parseFloat(document.getElementById('colonyCount').value) || 0;
            const dilutionFactor = parseFloat(document.getElementById('dilutionFactor').value) || 0;
            const sampleVolume = parseFloat(document.getElementById('sampleVolume').value) || 0;
            
            if (colonyCount <= 0 || dilutionFactor <= 0 || sampleVolume <= 0) {
                document.getElementById('microbialCountResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const microbialCount = colonyCount * dilutionFactor / sampleVolume;
            
            let acceptance = '';
            let color = '';
            
            if (microbialCount <= 100) {
                acceptance = currentLanguage === 'en' ? 'Within Specification' : 'ضمن المواصفات';
                color = 'var(--ok)';
            } else if (microbialCount <= 1000) {
                acceptance = currentLanguage === 'en' ? 'Action Limit' : 'حد الإجراء';
                color = 'var(--warn)';
            } else {
                acceptance = currentLanguage === 'en' ? 'Out of Specification' : 'خارج المواصفات';
                color = 'var(--bad)';
            }
            
            document.getElementById('microbialCountResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Colony Count:' : 'عدد المستعمرات:'}</strong> ${colonyCount} cfu</div>
                <div><strong>${currentLanguage === 'en' ? 'Dilution Factor:' : 'عامل التخفيف:'}</strong> ${dilutionFactor}</div>
                <div><strong>${currentLanguage === 'en' ? 'Sample Volume:' : 'حجم العينة:'}</strong> ${sampleVolume.toFixed(1)} ${sampleVolume === 1 ? 'g' : 'mL'}</div>
                <div><strong>${currentLanguage === 'en' ? 'Microbial Count:' : 'العد الميكروبي:'}</strong> ${microbialCount.toFixed(0)} cfu/${sampleVolume === 1 ? 'g' : 'mL'}</div>
                <div style="margin-top: 5px;">
                    <strong>${currentLanguage === 'en' ? 'Acceptance:' : 'القبول:'}</strong> 
                    <span style="color: ${color}; font-weight: 600;">${acceptance}</span>
                </div>
            `;
        }
        
        function calculateEndotoxin() {
            const sampleEndotoxin = parseFloat(document.getElementById('sampleEndotoxin').value) || 0;
            const maximumDose = parseFloat(document.getElementById('maximumDose').value) || 0;
            const endotoxinLimit = parseFloat(document.getElementById('endotoxinLimit').value) || 0;
            
            if (sampleEndotoxin <= 0 || maximumDose <= 0 || endotoxinLimit <= 0) {
                document.getElementById('endotoxinResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const mdd = maximumDose; // Maximum Daily Dose in mL/kg
            const k = 5.0; // EU/kg for parenteral drugs
            const endotoxinConcentration = sampleEndotoxin; // EU/mL
            
            const endotoxinAllowance = k / mdd;
            const endotoxinResult = endotoxinConcentration <= endotoxinAllowance;
            
            let result = '';
            let color = '';
            
            if (endotoxinResult) {
                result = currentLanguage === 'en' ? 'PASS - Within Specification' : 'مقبول - ضمن المواصفات';
                color = 'var(--ok)';
            } else {
                result = currentLanguage === 'en' ? 'FAIL - Exceeds Allowable Limit' : 'مرفوض - يتجاوز الحد المسموح';
                color = 'var(--bad)';
            }
            
            document.getElementById('endotoxinResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Sample Endotoxin:' : 'السموم الداخلية في العينة:'}</strong> ${sampleEndotoxin.toFixed(2)} EU/mL</div>
                <div><strong>${currentLanguage === 'en' ? 'Maximum Daily Dose:' : 'الجرعة اليومية القصوى:'}</strong> ${maximumDose.toFixed(1)} mL/kg</div>
                <div><strong>${currentLanguage === 'en' ? 'Endotoxin Limit (K):' : 'حد السموم الداخلية (K):'}</strong> ${endotoxinLimit.toFixed(1)} EU/kg</div>
                <div><strong>${currentLanguage === 'en' ? 'Allowable Endotoxin:' : 'السموم الداخلية المسموحة:'}</strong> ${endotoxinAllowance.toFixed(2)} EU/mL</div>
                <div style="margin-top: 5px;">
                    <strong>${currentLanguage === 'en' ? 'Result:' : 'النتيجة:'}</strong> 
                    <span style="color: ${color}; font-weight: 600;">${result}</span>
                </div>
            `;
        }
        
        function calculateShelfLife() {
            const assayInitial = parseFloat(document.getElementById('assayInitial').value) || 0;
            const assay12m = parseFloat(document.getElementById('assay12m').value) || 0;
            const assaySpec = document.getElementById('assaySpec').value;
            const degradationRate = parseFloat(document.getElementById('degradationRate').value) || 0;
            
            if (assayInitial <= 0 || assay12m <= 0 || degradationRate <= 0) {
                document.getElementById('shelfLifeResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            const specParts = assaySpec.split('-');
            let lowerSpec = 95, upperSpec = 105;
            
            if (specParts.length === 2) {
                lowerSpec = parseFloat(specParts[0]);
                upperSpec = parseFloat(specParts[1]);
            }
            
            const degradationPerYear = assayInitial - assay12m;
            const monthsToLowerSpec = ((assayInitial - lowerSpec) / degradationRate);
            const monthsToUpperSpec = ((upperSpec - assayInitial) / degradationRate);
            
            const shelfLifeMonths = Math.min(monthsToLowerSpec, monthsToUpperSpec);
            const shelfLifeYears = shelfLifeMonths / 12;
            
            let stability = '';
            let color = '';
            
            if (shelfLifeYears >= 3) {
                stability = currentLanguage === 'en' ? 'Excellent Stability' : 'استقرار ممتاز';
                color = 'var(--ok)';
            } else if (shelfLifeYears >= 2) {
                stability = currentLanguage === 'en' ? 'Good Stability' : 'استقرار جيد';
                color = 'var(--ok)';
            } else if (shelfLifeYears >= 1) {
                stability = currentLanguage === 'en' ? 'Acceptable Stability' : 'استقرار مقبول';
                color = 'var(--warn)';
            } else {
                stability = currentLanguage === 'en' ? 'Poor Stability' : 'استقرار ضعيف';
                color = 'var(--bad)';
            }
            
            document.getElementById('shelfLifeResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Initial Assay:' : 'المعايرة الأولية:'}</strong> ${assayInitial.toFixed(1)}%</div>
                <div><strong>${currentLanguage === 'en' ? 'Assay at 12 months:' : 'المعايرة عند 12 شهراً:'}</strong> ${assay12m.toFixed(1)}%</div>
                <div><strong>${currentLanguage === 'en' ? 'Degradation Rate:' : 'معدل التحلل:'}</strong> ${degradationRate.toFixed(2)}%/month</div>
                <div><strong>${currentLanguage === 'en' ? 'Specification:' : 'المواصفات:'}</strong> ${lowerSpec.toFixed(1)}% - ${upperSpec.toFixed(1)}%</div>
                <div><strong>${currentLanguage === 'en' ? 'Estimated Shelf Life:' : 'مدة الصلاحية المقدرة:'}</strong> ${shelfLifeMonths.toFixed(0)} months (${shelfLifeYears.toFixed(1)} years)</div>
                <div style="margin-top: 5px;">
                    <strong>${currentLanguage === 'en' ? 'Stability Rating:' : 'تصنيف الاستقرار:'}</strong> 
                    <span style="color: ${color}; font-weight: 600;">${stability}</span>
                </div>
            `;
        }
        
        function calculateTestingPoints() {
            const studyDuration = parseInt(document.getElementById('studyDuration').value) || 0;
            const studyType = document.getElementById('studyType').value;
            
            if (studyDuration <= 0) {
                document.getElementById('testingPointsResult').innerHTML = 
                    `<span style="color: var(--bad);">${currentLanguage === 'en' ? 'Please enter valid data' : 'يرجى إدخال بيانات صحيحة'}</span>`;
                return;
            }
            
            let testingPoints = [];
            
            if (studyType === 'accelerated') {
                // Accelerated: 0, 1, 2, 3, 6 months
                testingPoints = [0, 1, 2, 3, 6];
                if (studyDuration > 6) testingPoints.push(studyDuration);
            } else if (studyType === 'intermediate') {
                // Intermediate: 0, 3, 6, 9, 12, 18, 24, 36 months
                testingPoints = [0, 3, 6, 9, 12, 18, 24];
                if (studyDuration > 24) testingPoints.push(36);
            } else {
                // Long term: 0, 3, 6, 9, 12, 18, 24, 36, 48, 60 months
                testingPoints = [0, 3, 6, 9, 12, 18, 24, 36];
                if (studyDuration > 36) testingPoints.push(48);
                if (studyDuration > 48) testingPoints.push(60);
            }
            
            // Filter points based on study duration
            testingPoints = testingPoints.filter(point => point <= studyDuration);
            
            const testingPointsText = testingPoints.join(', ');
            
            document.getElementById('testingPointsResult').innerHTML = `
                <div><strong>${currentLanguage === 'en' ? 'Study Type:' : 'نوع الدراسة:'}</strong> ${studyType === 'long-term' ? (currentLanguage === 'en' ? 'Long Term' : 'طويل الأمد') : studyType === 'intermediate' ? (currentLanguage === 'en' ? 'Intermediate' : 'متوسط') : (currentLanguage === 'en' ? 'Accelerated' : 'مسرع')}</div>
                <div><strong>${currentLanguage === 'en' ? 'Study Duration:' : 'مدة الدراسة:'}</strong> ${studyDuration} months</div>
                <div><strong>${currentLanguage === 'en' ? 'Testing Points:' : 'نقاط الاختبار:'}</strong> ${testingPointsText} months</div>
                <div><strong>${currentLanguage === 'en' ? 'Number of Testing Points:' : 'عدد نقاط الاختبار:'}</strong> ${testingPoints.length}</div>
                <div style="font-size: 12px; color: #666; margin-top: 5px;">
                    ${currentLanguage === 'en' 
                        ? 'According to ICH Q1A(R2) guidelines' 
                        : 'وفقاً لإرشادات ICH Q1A(R2)'}
                </div>
            `;
        }
        
        // ===== ANALYSIS ENTRY FUNCTIONS =====
        function nextStep(step) {
            if (step === 1) {
                // Validate step 1
                const materialType = document.getElementById('materialType').value;
                const materialName = document.getElementById('materialName').value;
                const batchNumber = document.getElementById('batchNumber').value;
                
                if (!materialType || !materialName || !batchNumber) {
                    showToast(currentLanguage === 'en' ? 'Please fill all required fields' : 'يرجى ملء جميع الحقول المطلوبة', 'warning');
                    return;
                }
                
                analysisData.materialType = materialType;
                analysisData.materialName = materialName;
                analysisData.batchNumber = batchNumber;
                analysisData.manufacturer = document.getElementById('manufacturer').value;
                
                document.getElementById('section1').style.display = 'none';
                document.getElementById('section2').style.display = 'block';
                updateStepper(2);
            } else if (step === 2) {
                // Validate step 2
                if (selectedTests.length === 0) {
                    showToast(currentLanguage === 'en' ? 'Please select at least one test' : 'يرجى اختيار اختبار واحد على الأقل', 'warning');
                    return;
                }
                
                analysisData.selectedTests = selectedTests;
                analysisData.pharmacopoeia = selectedPharmacopoeia;
                
                // Load results entry form
                loadResultsEntry();
                
                document.getElementById('section2').style.display = 'none';
                document.getElementById('section3').style.display = 'block';
                updateStepper(3);
            } else if (step === 3) {
                // Validate step 3
                let allFilled = true;
                selectedTests.forEach(test => {
                    const resultInput = document.getElementById(`result_${test}`);
                    if (resultInput && !resultInput.value) {
                        allFilled = false;
                    }
                });
                
                if (!allFilled) {
                    showToast(currentLanguage === 'en' ? 'Please enter results for all selected tests' : 'يرجى إدخال نتائج جميع الاختبارات المختارة', 'warning');
                    return;
                }
                
                // Collect results
                analysisData.results = {};
                selectedTests.forEach(test => {
                    const resultInput = document.getElementById(`result_${test}`);
                    if (resultInput) {
                        analysisData.results[test] = resultInput.value;
                    }
                });
                
                // Load review
                loadReview();
                
                document.getElementById('section3').style.display = 'none';
                document.getElementById('section4').style.display = 'block';
                updateStepper(4);
            }
        }
        
        function previousStep(step) {
            if (step === 2) {
                document.getElementById('section2').style.display = 'none';
                document.getElementById('section1').style.display = 'block';
                updateStepper(1);
            } else if (step === 3) {
                document.getElementById('section3').style.display = 'none';
                document.getElementById('section2').style.display = 'block';
                updateStepper(2);
            } else if (step === 4) {
                document.getElementById('section4').style.display = 'none';
                document.getElementById('section3').style.display = 'block';
                updateStepper(3);
            }
        }
        
        function updateStepper(step) {
            // Reset all steps
            document.querySelectorAll('.step').forEach(stepEl => {
                stepEl.classList.remove('active', 'completed');
            });
            
            // Set completed steps
            for (let i = 1; i < step; i++) {
                const stepEl = document.getElementById(`step${i}`);
                if (stepEl) {
                    stepEl.classList.add('completed');
                }
            }
            
            // Set active step
            const currentStepEl = document.getElementById(`step${step}`);
            if (currentStepEl) {
                currentStepEl.classList.add('active');
            }
        }
        
        function togglePharmacopoeia(pharmacopoeia) {
            const index = selectedPharmacopoeia.indexOf(pharmacopoeia);
            if (index === -1) {
                selectedPharmacopoeia.push(pharmacopoeia);
            } else {
                selectedPharmacopoeia.splice(index, 1);
            }
            
            // Update UI
            const buttons = document.querySelectorAll('.btn[onclick^="togglePharmacopoeia"]');
            buttons.forEach(btn => {
                if (selectedPharmacopoeia.includes(btn.textContent.trim())) {
                    btn.style.border = '2px solid var(--navy)';
                } else {
                    btn.style.border = '1px solid var(--border)';
                }
            });
        }
        
        function toggleTestSelection(testId) {
            const testElement = document.getElementById(`test_${testId}`);
            
            if (selectedTests.includes(testId)) {
                // Remove from selection
                selectedTests = selectedTests.filter(test => test !== testId);
                testElement.style.background = testId.includes('tamc') || testId.includes('tymc') || testId.includes('e_coli') 
                    ? '#e8f5e9' 
                    : 'white';
                testElement.style.borderColor = testId.includes('tamc') || testId.includes('tymc') || testId.includes('e_coli')
                    ? 'var(--ok)'
                    : 'var(--border)';
            } else {
                // Add to selection
                selectedTests.push(testId);
                testElement.style.background = '#e3f2fd';
                testElement.style.borderColor = 'var(--info)';
            }
        }
        
        function loadResultsEntry() {
            const container = document.getElementById('resultsEntryContainer');
            container.innerHTML = '';
            
            selectedTests.forEach((test, index) => {
                const testName = getTestName(test);
                const testSpec = getTestSpecification(test);
                
                const testDiv = document.createElement('div');
                testDiv.style.marginBottom = '15px';
                testDiv.style.padding = '15px';
                testDiv.style.border = '1px solid var(--border)';
                testDiv.style.borderRadius = '6px';
                testDiv.style.background = '#f8f9fa';
                
                testDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div>
                            <strong>${testName}</strong>
                            <div style="font-size: 12px; color: #666;">${testSpec}</div>
                        </div>
                        <div style="font-size: 12px; color: var(--info);">Test ${index + 1} of ${selectedTests.length}</div>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 14px;">${currentLanguage === 'en' ? 'Result:' : 'النتيجة:'}</label>
                        <input type="text" 
                               id="result_${test}" 
                               style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px;" 
                               placeholder="${currentLanguage === 'en' ? 'Enter test result' : 'أدخل نتيجة الاختبار'}">
                    </div>
                `;
                
                container.appendChild(testDiv);
            });
        }
        
        function loadReview() {
            const container = document.getElementById('reviewContainer');
            container.innerHTML = '';
            
            // Material Information
            const materialInfo = document.createElement('div');
            materialInfo.style.marginBottom = '20px';
            materialInfo.innerHTML = `
                <h4 style="color: var(--navy); margin-bottom: 10px;">${currentLanguage === 'en' ? 'Material Information' : 'معلومات المادة'}</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <div><strong>${currentLanguage === 'en' ? 'Material Type:' : 'نوع المادة:'}</strong> ${analysisData.materialType}</div>
                    <div><strong>${currentLanguage === 'en' ? 'Material Name:' : 'اسم المادة:'}</strong> ${analysisData.materialName}</div>
                    <div><strong>${currentLanguage === 'en' ? 'Batch Number:' : 'رقم الدفعة:'}</strong> ${analysisData.batchNumber}</div>
                    <div><strong>${currentLanguage === 'en' ? 'Manufacturer:' : 'الشركة المصنعة:'}</strong> ${analysisData.manufacturer || 'N/A'}</div>
                </div>
            `;
            container.appendChild(materialInfo);
            
            // Selected Tests
            const testsInfo = document.createElement('div');
            testsInfo.style.marginBottom = '20px';
            testsInfo.innerHTML = `
                <h4 style="color: var(--navy); margin-bottom: 10px;">${currentLanguage === 'en' ? 'Selected Tests' : 'الاختبارات المختارة'}</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    ${selectedTests.map(test => `
                        <div style="background: white; padding: 8px; border-radius: 4px; border: 1px solid var(--border);">
                            <strong>${getTestName(test)}</strong>
                            <div style="font-size: 12px; color: #666;">${getTestSpecification(test)}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            container.appendChild(testsInfo);
            
            // Results
            const resultsInfo = document.createElement('div');
            resultsInfo.innerHTML = `
                <h4 style="color: var(--navy); margin-bottom: 10px;">${currentLanguage === 'en' ? 'Test Results' : 'نتائج الاختبارات'}</h4>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="padding: 8px; border: 1px solid #ddd;">${currentLanguage === 'en' ? 'Test' : 'الاختبار'}</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">${currentLanguage === 'en' ? 'Result' : 'النتيجة'}</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">${currentLanguage === 'en' ? 'Status' : 'الحالة'}</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${selectedTests.map(test => `
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">${getTestName(test)}</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">${analysisData.results[test] || ''}</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">
                                        <span style="color: ${checkTestResult(test, analysisData.results[test]) ? 'var(--ok)' : 'var(--bad)'};">
                                            ${checkTestResult(test, analysisData.results[test]) ? '✓' : '✗'}
                                        </span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            container.appendChild(resultsInfo);
        }
        
        function getTestName(testId) {
            const testNames = {
                'appearance': currentLanguage === 'en' ? 'Appearance' : 'المظهر',
                'identification': currentLanguage === 'en' ? 'Identification' : 'التعريف',
                'assay': currentLanguage === 'en' ? 'Assay' : 'المعايرة',
                'related_substances': currentLanguage === 'en' ? 'Related Substances' : 'المواد ذات الصلة',
                'tamc': 'TAMC',
                'tymc': 'TYMC',
                'e_coli': 'E. coli'
            };
            
            return testNames[testId] || testId;
        }
        
        function getTestSpecification(testId) {
            const specifications = {
                'appearance': currentLanguage === 'en' ? 'Visual inspection' : 'فحص بصري',
                'identification': currentLanguage === 'en' ? 'IR spectrum matches reference' : 'يطابق طيف الأشعة تحت الحمراء المرجع',
                'assay': currentLanguage === 'en' ? '95.0% - 105.0%' : '95.0% - 105.0%',
                'related_substances': currentLanguage === 'en' ? 'Total impurities ≤ 2.0%' : 'إجمالي الشوائب ≤ 2.0%',
                'tamc': currentLanguage === 'en' ? '≤ 1000 cfu/g' : '≤ 1000 وحدة مستعمرة/غ',
                'tymc': currentLanguage === 'en' ? '≤ 100 cfu/g' : '≤ 100 وحدة مستعمرة/غ',
                'e_coli': currentLanguage === 'en' ? 'Absent in 10g' : 'غير موجود في 10غ'
            };
            
            return specifications[testId] || '';
        }
        
        function checkTestResult(testId, result) {
            // This is a simplified check. In real implementation, you would have more complex logic
            if (!result) return false;
            
            // For demonstration purposes, assume all results are valid
            return true;
        }
        
        function generateAnalysisReport() {
            showToast(currentLanguage === 'en' ? 'Analysis report generated successfully' : 'تم إنشاء تقرير التحليل بنجاح', 'success');
        }
        
        function submitAnalysis() {
            showToast(currentLanguage === 'en' ? 'Analysis submitted successfully' : 'تم إرسال التحليل بنجاح', 'success');
            
            // Reset form
            setTimeout(() => {
                document.getElementById('materialType').value = '';
                document.getElementById('materialName').value = '';
                document.getElementById('batchNumber').value = '';
                document.getElementById('manufacturer').value = '';
                
                selectedPharmacopoeia = [];
                selectedTests = [];
                analysisData = {};
                
                document.getElementById('section4').style.display = 'none';
                document.getElementById('section1').style.display = 'block';
                updateStepper(1);
                
                // Reset test selection UI
                document.querySelectorAll('#standardTests > div, #microbiologyTests > div').forEach(el => {
                    el.style.background = el.id.includes('tamc') || el.id.includes('tymc') || el.id.includes('e_coli') 
                        ? '#e8f5e9' 
                        : 'white';
                    el.style.borderColor = el.id.includes('tamc') || el.id.includes('tymc') || el.id.includes('e_coli')
                        ? 'var(--ok)'
                        : 'var(--border)';
                });
                
                // Reset pharmacopoeia buttons
                document.querySelectorAll('.btn[onclick^="togglePharmacopoeia"]').forEach(btn => {
                    btn.style.border = '1px solid var(--border)';
                });
            }, 1500);
        }
        
        // ===== COA GENERATOR FUNCTIONS =====
        function printCOA() {
            // Update print preview with current values
            updateCOAPreview();
            
            // Show print preview
            document.getElementById('coaPrintPreview').style.display = 'block';
            
            // Trigger print
            setTimeout(() => {
                window.print();
                document.getElementById('coaPrintPreview').style.display = 'none';
            }, 500);
        }
        
        function downloadCOA() {
            // Update print preview
            updateCOAPreview();
            
            // Create a downloadable link (simulated)
            showToast(currentLanguage === 'en' ? 'COA download started' : 'بدأ تنزيل شهادة التحليل', 'info');
            
            // In a real implementation, you would generate a PDF here
            setTimeout(() => {
                showToast(currentLanguage === 'en' ? 'COA downloaded successfully' : 'تم تنزيل شهادة التحليل بنجاح', 'success');
            }, 1500);
        }
        
        function previewCOA() {
            updateCOAPreview();
            document.getElementById('coaPrintPreview').style.display = 'block';
            document.getElementById('coaPrintPreview').scrollIntoView({ behavior: 'smooth' });
        }
        
        function updateCOAPreview() {
            // Update COA preview with form values
            document.getElementById('coaCompanyName').textContent = document.getElementById('companyName').value;
            document.getElementById('coaProductName').textContent = document.getElementById('productName').value;
            document.getElementById('coaBatchNumberDisplay').textContent = document.getElementById('coaBatchNumber').value;
            document.getElementById('coaManufactureDate').textContent = document.getElementById('manufactureDate').value;
            document.getElementById('coaExpiryDate').textContent = document.getElementById('expiryDate').value;
            document.getElementById('coaReleaseDate').textContent = document.getElementById('releaseDate').value;
            
            // Generate COA number
            const coaNumber = 'COA-' + new Date().getFullYear() + '-' + String(Math.floor(Math.random() * 1000)).padStart(3, '0');
            document.getElementById('coaNumber').textContent = coaNumber;
            
            // Set dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('coaAnalystDate').textContent = today;
            document.getElementById('coaQADate').textContent = today;
            
            // Update results table
            const resultsTable = document.getElementById('coaPrintResults');
            resultsTable.innerHTML = '';
            
            // Get all test results from the form
            const testRows = document.querySelectorAll('#coaTestResults tr');
            testRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length >= 4) {
                    const test = cells[0].textContent;
                    const spec = cells[1].textContent;
                    const result = cells[2].textContent;
                    const compliance = cells[3].innerHTML.includes('✓') ? 
                        (currentLanguage === 'en' ? 'Complies' : 'مطابق') : 
                        (currentLanguage === 'en' ? 'Does Not Comply' : 'غير مطابق');
                    
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td style="padding: 10px; border: 1px solid #ddd;">${test}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${spec}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${result}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">USP/BP</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${compliance}</td>
                    `;
                    resultsTable.appendChild(newRow);
                }
            });
        }
        
        function generateCOA(batchNumber) {
            // Fill COA form with batch data
            document.getElementById('coaBatchNumber').value = batchNumber;
            
            // Switch to COA generator tab
            showTab('coa-generator');
            
            showToast(currentLanguage === 'en' ? `COA generated for batch ${batchNumber}` : `تم إنشاء شهادة تحليل للدفعة ${batchNumber}`, 'success');
        }
        
        // ===== REPORT FUNCTIONS =====
        function generateReport(reportType) {
            const reportNames = {
                'coa': currentLanguage === 'en' ? 'Certificate of Analysis' : 'شهادة التحليل',
                'batch': currentLanguage === 'en' ? 'Batch Release Certificate' : 'شهادة إصدار الدفعة',
                'stability': currentLanguage === 'en' ? 'Stability Report' : 'تقرير الاستقرار',
                'summary': currentLanguage === 'en' ? 'Summary Report' : 'تقرير الملخص'
            };
            
            showToast(`${currentLanguage === 'en' ? 'Generating' : 'جاري إنشاء'} ${reportNames[reportType]}...`, 'info');
            
            setTimeout(() => {
                showToast(`${reportNames[reportType]} ${currentLanguage === 'en' ? 'generated successfully' : 'تم إنشاؤه بنجاح'}`, 'success');
            }, 1000);
        }
        
        function printReport(reference) {
            showToast(`${currentLanguage === 'en' ? 'Printing' : 'جاري طباعة'} ${reference}...`, 'info');
        }
        
        function downloadReport(reference) {
            showToast(`${currentLanguage === 'en' ? 'Downloading' : 'جاري تنزيل'} ${reference}...`, 'info');
            
            setTimeout(() => {
                showToast(`${reference} ${currentLanguage === 'en' ? 'downloaded successfully' : 'تم تنزيله بنجاح'}`, 'success');
            }, 1000);
        }
        
        // ===== TOAST NOTIFICATION =====
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            const icons = {
                'success': 'fa-check-circle',
                'danger': 'fa-exclamation-circle',
                'warning': 'fa-exclamation-triangle',
                'info': 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <i class="fas ${icons[type]}" style="font-size: 20px; color: var(--${type === 'success' ? 'ok' : type === 'danger' ? 'bad' : type === 'warning' ? 'warn' : 'info'});"></i>
                <div style="flex: 1;">
                    <div style="font-weight: 600; font-size: 14px;">${message}</div>
                    <div style="font-size: 12px; color: #666;">${new Date().toLocaleTimeString()}</div>
                </div>
                <i class="fas fa-times" style="cursor: pointer; color: #999;" onclick="this.parentElement.remove()"></i>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }
        
        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize IPQC calculators
            initializeIPQCCalculators();
            
            // Set default dates for COA generator
            const today = new Date();
            const expiryDate = new Date(today);
            expiryDate.setFullYear(today.getFullYear() + 2);
            
            document.getElementById('manufactureDate').value = today.toISOString().split('T')[0];
            document.getElementById('expiryDate').value = expiryDate.toISOString().split('T')[0];
            document.getElementById('releaseDate').value = today.toISOString().split('T')[0];
            
            // Show dashboard by default
            showTab('dashboard');
        });
    </script>
</body>
</html>